 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#ff6b6b">
    <title>Durga Puja Pandal Map - Kolkata 2025</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Improve scrolling performance on mobile */
        html {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
            min-height: 100vh;
            -webkit-text-size-adjust: 100%; /* Prevent text scaling on iOS */
            -ms-text-size-adjust: 100%;
            overscroll-behavior: none; /* Prevent pull-to-refresh */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .col-md-8 {
            flex: 1;
            min-width: 300px;
        }

        .col-md-4 {
            flex: 0 0 420px;
            min-width: 350px;
            max-width: 100%;
        }

        /* Location Selector Overlay */
        .location-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.95), rgba(255, 140, 0, 0.95));
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .location-selector {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: slideInUp 0.8s ease;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .location-selector h2 {
            color: #8B0000;
            margin-bottom: 10px;
            font-size: 2.5rem;
            font-weight: bold;
        }

        .location-selector p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .location-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .location-card {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .location-card h3 {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .location-card p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 0;
        }

        .location-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .selector-footer {
            margin-top: 20px;
            color: #888;
            font-size: 0.9rem;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #d32f2f 0%, #f57c00 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Navigation */
        .navbar {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            min-height: 44px; /* iOS recommended touch target size */
            min-width: 44px;
            justify-content: center;
            text-align: center;
            -webkit-tap-highlight-color: transparent; /* Remove iOS tap highlight */
            touch-action: manipulation; /* Improve touch response */
            margin: 4px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #9c27b0 0%, #e91e63 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #ffc107 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Enhanced Routing Styles */
        .routing-summary {
            background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .enhanced-route-icon {
            animation: none;
        }

        .enhanced-route-icon:hover {
            animation: pulse 1s infinite;
        }

        .custom-number-icon {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bold;
        }

        /* Route info cards */
        .route-info-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .route-step {
            background: #f8f9fa;
            border-left: 3px solid #2196f3;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .route-step:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        /* Navigation improvements */
        .navigation-panel {
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #2196f3;
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.2);
        }

        /* Leaflet routing control customization */
        .leaflet-routing-container {
            background: white !important;
            border-radius: 10px !important;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15) !important;
        }

        .leaflet-routing-alt {
            margin: 8px !important;
            padding: 12px !important;
            border-radius: 8px !important;
            border: 1px solid #e0e0e0 !important;
        }

        .leaflet-routing-alt:first-child {
            border-color: #2196f3 !important;
            background: #e3f2fd !important;
        }

        /* Transport Mode Selection */
        .transport-mode-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 8px 4px;
            cursor: pointer;
            text-align: center;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .transport-mode-btn:hover {
            border-color: #2196f3;
            color: #2196f3;
            transform: translateY(-1px);
        }

        .transport-mode-btn.active {
            background: #2196f3;
            border-color: #2196f3;
            color: white;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .transport-mode-btn i {
            font-size: 16px;
        }

        /* Animated route segment */
        .current-route-segment {
            animation: route-pulse 2s ease-in-out infinite;
        }

        @keyframes route-pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.6; }
        }

        /* Route segment styling */
        .leaflet-interactive {
            cursor: pointer;
        }

        /* Main Content */
        main {
            padding: 30px 0;
            min-height: calc(100vh - 200px);
        }

        /* Map Container */
        .map-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .search-box {
            display: flex;
            margin-bottom: 15px;
            gap: 10px;
        }

        .search-box input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            -webkit-appearance: none; /* Remove iOS styling */
            appearance: none; /* Standard property */
            -webkit-tap-highlight-color: transparent;
        }

        .search-box input:focus {
            outline: none;
            border-color: #2196f3;
        }

        .search-box button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-controls select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=utf-8,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23666' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
            -webkit-tap-highlight-color: transparent;
        }

        /* Map */
        #map {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }

        /* Fullscreen Button */
        .fullscreen-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            border: none;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            font-size: 16px;
            color: #333;
            transition: all 0.3s ease;
        }

        .fullscreen-btn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        /* Fullscreen Mode */
        .map-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            border-radius: 0;
            padding: 0;
            background: white;
        }

        .map-container.fullscreen #map {
            height: 100vh;
            border-radius: 0;
        }

        .map-container.fullscreen .search-box,
        .map-container.fullscreen .filter-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .map-container.fullscreen .filter-controls {
            top: 80px;
        }

        .map-container.fullscreen .fullscreen-btn {
            top: 20px;
            right: 20px;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            height: fit-content;
            width: 100%;
            box-sizing: border-box;
        }

        .sidebar h3 {
            color: #d32f2f;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        /* Famous Pandals Section */
        .pandal-list {
            margin-bottom: 20px;
        }

        /* Route Planner Section */
        .route-planner {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 2px solid #dee2e6;
        }

        .route-planner h3 {
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #dee2e6;
        }

        /* Pandal Cards */
        .pandal-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .pandal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
        }

        .pandal-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .pandal-card h4 {
            color: #d32f2f;
            margin-bottom: 6px;
            font-size: 15px;
            line-height: 1.3;
            word-wrap: break-word;
        }

        .pandal-card p {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .pandal-card .theme {
            display: inline-block;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1976d2;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 6px;
        }

        .pandal-card .rating {
            float: right;
            color: #ff9800;
            font-weight: bold;
        }

        /* Route Planner */
        .route-planner {
            margin-top: 30px;
        }

        .selected-pandal {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .remove-pandal {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Search and Filter Controls */
        #pandal-search {
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #pandal-search:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        #area-filter, #theme-filter {
            transition: border-color 0.3s ease;
            cursor: pointer;
        }

        #area-filter:focus, #theme-filter:focus {
            outline: none;
            border-color: #007bff;
        }

        #filter-results {
            font-style: italic;
        }

        /* Enhanced pandal item styling */
        .pandal-item-theme {
            background: linear-gradient(90deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 3px;
            padding: 1px 4px;
            margin-top: 2px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #d32f2f;
        }

        .info-section {
            margin-bottom: 25px;
        }

        .info-section h3 {
            color: #d32f2f;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }

        .info-section ul {
            list-style: none;
            padding-left: 0;
        }

        .info-section li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .info-section li::before {
            content: '•';
            color: #ff6b6b;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, #d32f2f 0%, #f57c00 100%);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 50px;
        }

        .heart {
            color: #ff4081;
            font-size: 1.2em;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Custom Leaflet Popup */
        .custom-popup {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .custom-popup h3 {
            color: #d32f2f;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .custom-popup p {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .custom-popup .theme-tag {
            display: inline-block;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1976d2;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }

        /* Responsive Design */
        /* Tablet and small desktop */
        @media (max-width: 1024px) {
            .container {
                padding: 0 15px;
            }
            
            .col-md-4 {
                flex: 0 0 380px;
            }
            
            #map {
                height: 450px;
            }
        }

        /* Tablet portrait */
        @media (max-width: 768px) {
            .row {
                flex-direction: column;
                gap: 15px;
            }
            
            .col-md-4 {
                flex: 1;
                order: -1;
                min-width: 100%;
                max-width: 100%;
            }
            
            .col-md-8 {
                min-width: 100%;
            }
            
            header h1 {
                font-size: 1.8rem;
                text-align: center;
            }
            
            header p {
                text-align: center;
            }
            
            .nav-controls {
                justify-content: center;
                gap: 8px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 13px;
                margin: 3px;
            }
            
            .filter-controls {
                flex-direction: column;
                gap: 12px;
            }
            
            .filter-controls select {
                width: 100%;
                padding: 12px 15px;
                font-size: 16px; /* Prevent zoom on iOS */
            }
            
            #map {
                height: 400px;
                border-radius: 10px;
            }
            
            .sidebar {
                margin-bottom: 20px;
                padding: 15px;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }
            
            .search-box input {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        /* Mobile phones */
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            header {
                padding: 15px 0;
            }
            
            header h1 {
                font-size: 1.5rem;
                line-height: 1.3;
            }
            
            header p {
                font-size: 1rem;
                margin-top: 8px;
            }
            
            .navbar {
                padding: 12px 0;
            }
            
            .nav-controls {
                gap: 5px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
                margin: 2px;
                min-height: 40px;
            }
            
            #map {
                height: 350px;
                border-radius: 8px;
            }
            
            .map-container {
                padding: 0;
            }
            
            .search-box {
                margin-bottom: 15px;
                flex-direction: column;
                gap: 10px;
            }
            
            .search-box input,
            .search-box button {
                width: 100%;
                margin: 0;
            }
            
            .filter-controls {
                gap: 8px;
            }
            
            .sidebar {
                padding: 12px;
            }
            
            .pandal-card {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .pandal-card h4 {
                font-size: 14px;
                line-height: 1.4;
            }
            
            .pandal-card p {
                font-size: 12px;
            }
            
            .fullscreen-btn {
                width: 35px;
                height: 35px;
                padding: 8px;
            }
            
            .modal-content {
                margin: 5% auto;
                width: 98%;
                padding: 15px;
                border-radius: 10px;
            }
        }

        /* Extra small screens */
        @media (max-width: 360px) {
            header h1 {
                font-size: 1.3rem;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 11px;
                min-height: 38px;
            }
            
            .nav-controls {
                gap: 3px;
            }
            
            #map {
                height: 300px;
            }
            
            .pandal-card h4 {
                font-size: 13px;
            }
            
            .pandal-card p {
                font-size: 11px;
            }
            
            .sidebar {
                padding: 8px;
            }
        }

        /* Landscape orientation optimization */
        @media (max-height: 500px) and (orientation: landscape) {
            header {
                padding: 10px 0;
            }
            
            header h1 {
                font-size: 1.4rem;
            }
            
            .navbar {
                padding: 8px 0;
            }
            
            #map {
                height: 250px;
            }
            
            .row {
                gap: 10px;
            }
        }

        /* Touch-specific improvements */
        @media (pointer: coarse) {
            .btn {
                min-height: 48px; /* Better touch target for coarse pointers */
                min-width: 48px;
            }
            
            .pandal-card {
                cursor: default; /* Remove cursor pointer on touch devices */
            }
            
            .fullscreen-btn {
                min-width: 48px;
                min-height: 48px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #d32f2f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Intro Animation Styles */
        .intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b69 50%, #8b0000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeOut 1s ease 4s forwards;
        }

        .intro-image {
            width: 300px;
            height: 400px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.3);
            animation: zoomInGlow 2s ease forwards;
            border: 3px solid gold;
            background: linear-gradient(45deg, #8B0000, #FFD700, #FF6347);
            display: flex;
            align-items: center;
            justify-content: center;
            color: gold;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            flex-direction: column;
        }

        .intro-text {
            margin-top: 30px;
            font-size: 3rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            font-family: 'Georgia', serif;
            animation: slideUpFade 1.5s ease 1s forwards;
            opacity: 0;
            text-align: center;
        }

        .intro-subtitle {
            margin-top: 10px;
            font-size: 1.2rem;
            color: #FFF8DC;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
            animation: slideUpFade 1.5s ease 1.5s forwards;
            opacity: 0;
            text-align: center;
        }

        .intro-blessing {
            margin-top: 20px;
            font-size: 1rem;
            color: #FFE4B5;
            font-style: italic;
            animation: slideUpFade 1.5s ease 2s forwards;
            opacity: 0;
            text-align: center;
        }

        @keyframes zoomInGlow {
            0% {
                transform: scale(0.3) rotate(-10deg);
                opacity: 0;
                box-shadow: 0 0 0 rgba(255, 215, 0, 0);
            }
            50% {
                transform: scale(1.1) rotate(2deg);
                box-shadow: 0 20px 60px rgba(255, 215, 0, 0.5);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
                box-shadow: 0 20px 60px rgba(255, 215, 0, 0.3);
            }
        }

        @keyframes slideUpFade {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                visibility: visible;
            }
            100% {
                opacity: 0;
                visibility: hidden;
            }
        }

        /* Floating particles animation */
        .particle {
            position: absolute;
            background: #FFD700;
            border-radius: 50%;
            pointer-events: none;
            animation: float 6s infinite ease-in-out;
        }

        .particle:nth-child(1) { width: 4px; height: 4px; top: 20%; left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { width: 6px; height: 6px; top: 60%; left: 85%; animation-delay: 1s; }
        .particle:nth-child(3) { width: 3px; height: 3px; top: 40%; left: 90%; animation-delay: 2s; }
        .particle:nth-child(4) { width: 5px; height: 5px; top: 80%; left: 15%; animation-delay: 3s; }
        .particle:nth-child(5) { width: 4px; height: 4px; top: 30%; left: 5%; animation-delay: 4s; }
        .particle:nth-child(6) { width: 6px; height: 6px; top: 70%; left: 95%; animation-delay: 2.5s; }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
                opacity: 0.8;
            }
        }

        /* Hide main content during intro */
        .main-content {
            opacity: 0;
            animation: showMainContent 1s ease 4s forwards;
        }

        @keyframes showMainContent {
            to {
                opacity: 1;
            }
        }

        /* Feedback System Styles */
        .feedback-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: pulse-feedback 2s infinite;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255, 107, 107, 0.6);
        }

        @keyframes pulse-feedback {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .feedback-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .feedback-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideInUp 0.4s ease;
        }

        .feedback-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .feedback-form h3 {
            color: #d32f2f;
            margin-bottom: 15px;
            text-align: center;
        }

        .rating-container {
            text-align: center;
            margin: 15px 0;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 10px 0;
        }

        .rating-star {
            font-size: 30px;
            color: #ddd;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .rating-star:hover,
        .rating-star.active {
            color: #ffc107;
            transform: scale(1.1);
        }

        .feedback-form input,
        .feedback-form textarea {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.3s ease;
            resize: vertical;
        }

        .feedback-form input:focus,
        .feedback-form textarea:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .feedback-form textarea {
            min-height: 100px;
        }

        .feedback-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .feedback-submit-btn {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .feedback-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .feedback-cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .feedback-cancel-btn:hover {
            background: #5a6268;
        }

        .feedback-success {
            text-align: center;
            padding: 20px;
            color: #4caf50;
            display: none;
        }

        .feedback-success i {
            font-size: 50px;
            margin-bottom: 15px;
            display: block;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .feedback-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 18px;
            }

            .feedback-modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 95%;
            }

            .rating-star {
                font-size: 25px;
            }
        }

        /* Arrival Notification Styles */
        .arrival-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideInRight 0.5s ease-out, pulse 2s infinite 0.5s;
            max-width: 350px;
            min-width: 280px;
        }

        .notification-content {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .notification-icon {
            font-size: 2em;
            animation: bounce 1s infinite;
        }

        .notification-text h3 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            font-weight: bold;
        }

        .notification-text p {
            margin: 0 0 3px 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .notification-text small {
            font-size: 0.75em;
            opacity: 0.7;
        }

        .notification-close {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            opacity: 0.7;
            padding: 0;
            line-height: 1;
        }

        .notification-close:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        /* Progress indicator */
        #proximity-indicator {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            margin: 5px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Location Selector Overlay -->
    <div class="location-selector-overlay" id="location-selector-overlay">
        <div class="location-selector">
            <h2><i class="fas fa-map-marked-alt"></i> Welcome to PujaPop</h2>
            <p>Choose your location to explore Durga Puja pandals</p>
            
            <div class="location-options">
                <button class="location-card" onclick="window.selectLocation('kolkata')">
                    <i class="fas fa-city"></i>
                    <h3>Kolkata</h3>
                    <p>Main city with 50+ famous pandals</p>
                </button>
                
                <button class="location-card" onclick="window.selectLocation('kalyani')">
                    <i class="fas fa-leaf"></i>
                    <h3>Kalyani</h3>
                    <p>Beautiful suburban pandals</p>
                </button>
                
                <button class="location-card" onclick="window.selectLocation('chuchura')">
                    <i class="fas fa-water"></i>
                    <h3>Chuchura</h3>
                    <p>Historic town with traditional pandals</p>
                </button>
                
                <button class="location-card" onclick="window.selectLocation('bandel')">
                    <i class="fas fa-church"></i>
                    <h3>Bandel</h3>
                    <p>Heritage town with cultural celebrations</p>
                </button>
            </div>
            
            <div class="selector-footer">
                <p><i class="fas fa-info-circle"></i> You can change location anytime from the menu</p>
            </div>
        </div>
    </div>

    <!-- Intro Animation Overlay -->
    <div class="intro-overlay" id="intro-overlay">
        <!-- Floating particles -->
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        
        <!-- Main intro content -->
        <img src="https://github.com/workarijit06/puajpop/blob/main/1.jpg?raw=true" alt="Durga Maa" class="intro-image">
        
        <div class="intro-text">Welcome to PujaPop</div>
        <div class="intro-subtitle">Your Ultimate Durga Puja Guide</div>
        <div class="intro-blessing">✨ Jay Maa Durga ✨</div>
    </div>

    <!-- Main Website Content -->
    <div class="main-content">
    <header>
        <div class="container">
            <h1><i class="fas fa-map-marked-alt"></i> Durga Puja Pandal Map - Kolkata 2025</h1>
            <p>Your ultimate guide for pandal hopping in the City of Joy</p>
        </div>
    </header>

    <nav class="navbar">
        <div class="container">
            <div class="nav-controls">
                <button id="change-location-btn" class="btn btn-warning">
                    <i class="fas fa-map-marker-alt"></i> Change Location
                </button>
                <button id="show-all-btn" class="btn btn-primary">
                    <i class="fas fa-eye"></i> Show All Pandals
                </button>
                <button id="plan-route-btn" class="btn btn-secondary">
                    <i class="fas fa-route"></i> Plan Route
                </button>
                <button id="toggle-info-btn" class="btn btn-info">
                    <i class="fas fa-info-circle"></i> Festival Info
                </button>
                <button id="location-btn" class="btn btn-success">
                    <i class="fas fa-map-marker-alt"></i> Track My Location
                </button>
            </div>
            
            <!-- Mobile HTTPS Notice -->
            <div id="mobile-https-notice" class="alert alert-warning" style="display: none; margin: 10px 0; font-size: 14px;">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Mobile Notice:</strong> Live location requires HTTPS. If location tracking fails, please 
                <a href="#" onclick="showHttpsHelp()" style="color: #0066cc; text-decoration: underline;">click here for setup help</a>.
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="map-container">
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="Search pandals by name or area...">
                            <button id="search-btn"><i class="fas fa-search"></i></button>
                        </div>
                        
                        <div class="filter-controls">
                            <select id="area-filter">
                                <option value="">All Areas</option>
                                <option value="Kalyani">Kalyani</option>
                                <option value="North">North Kolkata</option>
                                <option value="Central">Central Kolkata</option>
                                <option value="South">South Kolkata</option>
                                <option value="East">East Kolkata</option>
                                <option value="West">West Kolkata</option>
                            </select>
                            
                            <select id="theme-filter">
                                <option value="">All Themes</option>
                                <option value="Traditional">Traditional</option>
                                <option value="Modern">Modern</option>
                                <option value="Eco-friendly">Eco-friendly</option>
                                <option value="Theme-based">Theme-based</option>
                            </select>
                        </div>
                        
                        <div id="map"></div>

    <!-- Feedback Button -->
    <button class="feedback-btn" onclick="openFeedbackModal()" title="Give Feedback">
        <i class="fas fa-comment"></i>
    </button>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="feedback-modal">
        <div class="feedback-modal-content">
            <div class="feedback-form" id="feedbackForm">
                <h3><i class="fas fa-heart" style="color: #ff6b6b;"></i> Share Your Experience</h3>
                
                <div class="rating-container">
                    <label>Rate your experience:</label>
                    <div class="rating-stars" id="ratingStars">
                        <span class="rating-star" data-rating="1">★</span>
                        <span class="rating-star" data-rating="2">★</span>
                        <span class="rating-star" data-rating="3">★</span>
                        <span class="rating-star" data-rating="4">★</span>
                        <span class="rating-star" data-rating="5">★</span>
                    </div>
                </div>

                <input type="text" id="feedbackName" placeholder="Your Name (Optional)" />
                
                <textarea id="feedbackMessage" placeholder="Tell us about your experience with the Durga Puja Map..."></textarea>
                
                <div class="feedback-buttons">
                    <button class="feedback-cancel-btn" onclick="closeFeedbackModal()">Cancel</button>
                    <button class="feedback-submit-btn" onclick="submitFeedback()">
                        <i class="fas fa-paper-plane"></i> Submit
                    </button>
                </div>
            </div>

            <div class="feedback-success" id="feedbackSuccess">
                <i class="fas fa-check-circle"></i>
                <h3>Thank You!</h3>
                <p>Your feedback helps us improve the Durga Puja Map experience.</p>
                <button class="feedback-submit-btn" onclick="closeFeedbackModal()" style="margin-top: 15px;">Close</button>
            </div>
        </div>
    </div>
                        <button class="fullscreen-btn" id="fullscreen-toggle" title="Toggle Fullscreen">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="sidebar">
                        <!-- Famous Pandals Section - Always Visible -->
                        <div class="pandal-list">
                            <h3><i class="fas fa-list"></i> Famous Pandals</h3>
                            <div id="pandal-cards"></div>
                        </div>
                        
                        <!-- Route Planner Section - Toggleable -->
                        <div class="route-planner" id="route-planner" style="display: none;">
                            <div style="border-top: 2px solid #e0e0e0; margin: 20px 0; padding-top: 20px;">
                                <h3><i class="fas fa-route"></i> Route Planner</h3>
                                
                                <!-- Transportation Mode Selection -->
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h4 style="color: #2196f3; margin-bottom: 10px;"><i class="fas fa-route"></i> Transportation Mode</h4>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                                        <button id="mode-walking" class="transport-mode-btn active" onclick="window.app.setTransportMode('foot')">
                                            <i class="fas fa-walking"></i><br>Walking
                                        </button>
                                        <button id="mode-driving" class="transport-mode-btn" onclick="window.app.setTransportMode('driving')">
                                            <i class="fas fa-car"></i><br>Driving
                                        </button>
                                        <button id="mode-cycling" class="transport-mode-btn" onclick="window.app.setTransportMode('cycling')">
                                            <i class="fas fa-bicycle"></i><br>Cycling
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="pandal-selection" style="display: block;">
                                    <h4 style="color: #d32f2f; margin-bottom: 15px;">Select Pandals to Visit:</h4>
                                    
                                    <!-- Search and Filter Controls -->
                                    <div style="margin-bottom: 15px;">
                                        <!-- Search Box -->
                                        <div style="margin-bottom: 10px;">
                                            <input type="text" id="pandal-search" placeholder="🔍 Search pandals..." 
                                                   style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                        </div>
                                        
                                        <!-- Filter Dropdowns -->
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                            <select id="area-filter" style="padding: 6px 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; background: white;">
                                                <option value="">All Areas</option>
                                                <option value="Kalyani">Kalyani</option>
                                                <option value="Salt Lake">Salt Lake</option>
                                                <option value="Chuchura">Chuchura</option>
                                                <option value="Bandel">Bandel</option>
                                                <option value="North">North</option>
                                                <option value="Central">Central</option>
                                                <option value="South">South</option>
                                                <option value="East">East</option>
                                                <option value="West">West</option>
                                            </select>
                                            
                                            <select id="theme-filter" style="padding: 6px 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; background: white;">
                                                <option value="">All Themes</option>
                                                <option value="Traditional">Traditional</option>
                                                <option value="Modern">Modern</option>
                                                <option value="Eco-friendly">Eco-friendly</option>
                                                <option value="Heritage">Heritage</option>
                                                <option value="Contemporary">Contemporary</option>
                                                <option value="Artistic">Artistic</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Clear Filters and Results Count -->
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                                            <div id="filter-results" style="font-size: 12px; color: #666;"></div>
                                            <button id="clear-filters-btn" style="padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; background: white; color: #666; font-size: 11px; cursor: pointer;">
                                                <i class="fas fa-times"></i> Clear
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div style="max-height: 250px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; margin: 10px 0; background: #f9f9f9;">
                                        <div id="pandal-checklist"></div>
                                    </div>
                                    <button id="start-route-btn" class="btn btn-primary" style="width: 100%; margin: 10px 0;">
                                        <i class="fas fa-play"></i> Start My Route
                                    </button>
                                </div>
                                
                                <div id="active-route" style="display: none;">
                                    <h4><i class="fas fa-navigation"></i> Active Route</h4>
                                    <div id="current-destination"></div>
                                    <div id="route-progress"></div>
                                    <div id="next-pandal"></div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 10px 0;">
                                        <button id="show-full-route-btn" class="btn btn-info" onclick="window.app.showFullRoute()">
                                            <i class="fas fa-map"></i> Full Route
                                        </button>
                                        <button id="arrived-btn" class="btn btn-success" onclick="window.app.arrivedAtPandal()">
                                            <i class="fas fa-check"></i> Arrived
                                        </button>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 5px 0;">
                                        <button id="undo-arrival-btn" class="btn btn-warning" onclick="window.app.undoLastArrival()" 
                                                style="display: none; font-size: 0.85em;">
                                            <i class="fas fa-undo"></i> Undo Last
                                        </button>
                                        <button id="end-route-btn" class="btn btn-secondary" onclick="window.app.resetRoute()" style="font-size: 0.85em;">
                                            <i class="fas fa-stop"></i> End Route
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="selected-pandals"></div>
                                <div id="route-info"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="info-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="fas fa-info-circle"></i> Durga Puja 2025 - Festival Information</h2>
            
            <div class="info-section">
                <h3><i class="fas fa-calendar-alt"></i> Festival Dates</h3>
                <ul>
                    <li><strong>Mahalaya:</strong> September 21, 2025</li>
                    <li><strong>Sasthi:</strong> September 27, 2025</li>
                    <li><strong>Saptami:</strong> September 28, 2025</li>
                    <li><strong>Ashtami:</strong> September 29, 2025</li>
                    <li><strong>Navami:</strong> September 30, 2025</li>
                    <li><strong>Dashami (Visarjan):</strong> October 1, 2025</li>
                </ul>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-bus"></i> Transportation Tips</h3>
                <ul>
                    <li>Use Metro for major destinations - extended hours during Puja</li>
                    <li>Bus services available but expect heavy crowds</li>
                    <li>Shared cabs and app-based rides may have surge pricing</li>
                    <li>Walking is often faster in crowded areas</li>
                </ul>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-shield-alt"></i> Safety Tips</h3>
                <ul>
                    <li>Stay hydrated and carry water</li>
                    <li>Keep valuables secure</li>
                    <li>Travel in groups, especially at night</li>
                    <li>Be aware of crowd movement</li>
                    <li>Keep emergency contacts handy</li>
                </ul>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-phone"></i> Emergency Contacts</h3>
                <ul>
                    <li><strong>Police:</strong> 100</li>
                    <li><strong>Fire:</strong> 101</li>
                    <li><strong>Ambulance:</strong> 108</li>
                    <li><strong>Tourist Helpline:</strong> 1033</li>
                </ul>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Made by Arijit Paswan | &copy; 2025 Durga Puja Pandal Map. Created for pandal hoppers in Kolkata. 
               <span class="heart">❤️</span> Made with love for Ma Durga</p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    
    <script>
        // Durga Puja Pandal Map Application
        class DurgaPujaMap {
            constructor() {
                this.map = null;
                this.markers = [];
                this.pandals = [];
                this.selectedPandals = [];
                this.routeControl = null;
                this.userLocationMarker = null;
                this.userLocation = null;
                this.watchId = null;
                this.isTrackingLocation = false;
                this.activeRoute = [];
                this.selectedLocation = null; // New property for location filtering
                this.currentDestinationIndex = 0;
                this.isRouteActive = false;
                this.routePolylines = [];
                this.styledSegments = []; // For styled route segments
                this.transportMode = 'foot'; // Default to walking
                
                // Enhanced navigation tracking
                this.visitedDestinations = []; // Track visited pandals with timestamps
                this.arrivalDetectionRadius = 0.04; // 40 meters in kilometers
                this.autoArrivalEnabled = true; // Enable automatic arrival detection
                this.lastNotificationTime = 0; // Prevent spam notifications
                this.routeStartTime = null; // Track when route started
                this.destinationArrivalTimes = []; // Track arrival times for each destination
                
                this.init();
            }

            init() {
                this.loadPandalData();
                this.initMap();
                this.bindEvents();
                this.renderPandalCards();
            }

            setLocation(location) {
                this.selectedLocation = location;
                this.loadPandalData(); // Reload data with location filter
                this.clearMap();
                this.addPandalMarkers();
                this.renderPandalCards();
                
                // Update map center based on location
                if (location === 'kolkata') {
                    this.map.setView([22.5726, 88.3639], 12);
                } else if (location === 'kalyani') {
                    this.map.setView([22.9751, 88.4345], 14);
                } else if (location === 'chuchura') {
                    this.map.setView([22.9034, 88.3967], 14);
                } else if (location === 'bandel') {
                    this.map.setView([22.9245, 88.3798], 14);
                }
            }

            loadPandalData() {
                // All pandals data with location field
                const allPandals = [
                    {
                        id: 1,
                        name: "Bagbazar Sarbojanin",
                        lat: 22.5958,
                        lng: 88.3639,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "One of the oldest and most famous pandals in Kolkata",
                        timings: "24 hours",
                        specialFeatures: "Traditional craftsmanship, Cultural programs",
                        rating: 4.8,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    {
                        id: 2,
                        name: "Kumortuli Park",
                        lat: 22.5942,
                        lng: 88.3678,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Famous for traditional idol making area",
                        timings: "5 AM - 12 AM",
                        specialFeatures: "Potter's colony, Traditional art",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "No parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    {
                        id: 3,
                        name: "Bosepukur Sitala Mandir",
                        lat: 22.5123,
                        lng: 88.3515,
                        area: "South",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Known for innovative themes and grand decorations",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Theme-based decorations, Light shows",
                        rating: 4.9,
                        crowdLevel: "Very High",
                        parkingAvailable: "Paid parking available",
                        nearestMetro: "Kasba"
                    },
                    {
                        id: 4,
                        name: "Santosh Mitra Square",
                        lat: 22.5629,
                        lng: 88.3433,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Famous for traditional pandal with massive crowds",
                        timings: "24 hours",
                        specialFeatures: "Traditional architecture, Cultural programs",
                        rating: 4.7,
                        crowdLevel: "Very High",
                        parkingAvailable: "No parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 5,
                        name: "College Square",
                        lat: 22.5726,
                        lng: 88.3586,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "One of the most famous and oldest pandals in Kolkata",
                        timings: "24 hours",
                        specialFeatures: "Heritage pandal, Traditional ceremonies",
                        rating: 4.8,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Mahatma Gandhi Road"
                    },
                    {
                        id: 6,
                        name: "Mohammad Ali Park",
                        lat: 22.5835,
                        lng: 88.3567,
                        area: "Central",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Known for innovative themes and modern decorations",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Modern themes, Art installations",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Paid parking nearby",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 7,
                        name: "Triangular Park (Gariahat)",
                        lat: 22.5154,
                        lng: 88.3659,
                        area: "South",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Popular South Kolkata pandal with creative themes",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Shopping area nearby, Theme decorations",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Mall parking available",
                        nearestMetro: "Rabindra Sarobar"
                    },
                    {
                        id: 8,
                        name: "Suruchi Sangha (New Alipore)",
                        lat: 22.5089,
                        lng: 88.3267,
                        area: "South",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Famous for elaborate theme-based decorations",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Award-winning themes, Professional decoration",
                        rating: 4.9,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Netaji Bhawan"
                    },
                    {
                        id: 9,
                        name: "Chetla Agrani Club",
                        lat: 22.5245,
                        lng: 88.3398,
                        area: "South",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Famous for traditional celebrations and community participation",
                        timings: "5 AM - 12 AM",
                        specialFeatures: "Community involvement, Traditional customs",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Netaji Bhawan"
                    },
                    {
                        id: 10,
                        name: "Deshapriya Park",
                        lat: 22.5298,
                        lng: 88.3567,
                        area: "South",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Known for innovative and award-winning themes",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Award-winning pandal, Innovative themes",
                        rating: 4.8,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Kalighat"
                    },
                    {
                        id: 11,
                        name: "Ballygunge Cultural Association",
                        lat: 22.5345,
                        lng: 88.3634,
                        area: "South",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Heritage pandal with traditional Bengali culture",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Cultural programs, Traditional architecture",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Rabindra Sarobar"
                    },
                    {
                        id: 12,
                        name: "Mudiali Club",
                        lat: 22.5789,
                        lng: 88.3723,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Famous North Kolkata pandal with rich heritage",
                        timings: "24 hours",
                        specialFeatures: "Heritage pandal, Traditional customs",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "No parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 13,
                        name: "Hatibagan Nabin Pally",
                        lat: 22.5923,
                        lng: 88.3598,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "One of the oldest pandals in North Kolkata",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Historical significance, Traditional decorations",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Shyama Charan"
                    },
                    {
                        id: 14,
                        name: "Sreebhumi Sporting Club",
                        lat: 22.5678,
                        lng: 88.4123,
                        area: "East",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Famous for grand theme-based decorations and replica monuments",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Monument replicas, Grand themes",
                        rating: 4.9,
                        crowdLevel: "Very High",
                        parkingAvailable: "Paid parking available",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 15,
                        name: "Jodhpur Park",
                        lat: 22.5012,
                        lng: 88.3789,
                        area: "South",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Known for creative themes and modern artistic approach",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Artistic themes, Modern decoration",
                        rating: 4.7,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking available",
                        nearestMetro: "Joka"
                    },
                    {
                        id: 16,
                        name: "66 Palli (Saltlake)",
                        lat: 22.5789,
                        lng: 88.4234,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Popular Saltlake pandal with traditional celebrations",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Modern locality, Traditional celebrations",
                        rating: 4.5,
                        crowdLevel: "Medium",
                        parkingAvailable: "Ample parking",
                        nearestMetro: "Bidhannagar"
                    },
                    {
                        id: 17,
                        name: "Shib Mandir (Tollygunge)",
                        lat: 22.4789,
                        lng: 88.3567,
                        area: "South",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Traditional South Kolkata pandal with spiritual significance",
                        timings: "5 AM - 10 PM",
                        specialFeatures: "Spiritual significance, Traditional rituals",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Tollygunge"
                    },
                    {
                        id: 18,
                        name: "Behala Nutan Dal",
                        lat: 22.4923,
                        lng: 88.3145,
                        area: "South",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Popular Behala pandal known for innovative themes",
                        timings: "6 AM - 11 PM",
                        specialFeatures: "Innovative themes, Community participation",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Behala Chowrasta"
                    },
                    {
                        id: 19,
                        name: "Badamtala Ashar Sangha",
                        lat: 22.5567,
                        lng: 88.3823,
                        area: "East",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Famous for unique and creative theme-based pandals",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Creative themes, Professional decoration",
                        rating: 4.8,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 20,
                        name: "Hindustan Park",
                        lat: 22.5234,
                        lng: 88.3678,
                        area: "South",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Heritage pandal in South Kolkata with traditional celebrations",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Heritage value, Traditional customs",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Park available",
                        nearestMetro: "Rabindra Sarobar"
                    },
                    // Salt Lake Pandals
                    {
                        id: 21,
                        name: "AJ Block Durga Puja 2025",
                        lat: 22.5913,
                        lng: 88.4287,
                        area: "Salt Lake",
                        location: "kolkata",
                        theme: "Modern",
                        description: "AJ Block Sector II pandal with contemporary celebrations",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Modern decorations, Community participation",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Block parking available",
                        nearestMetro: "Salt Lake Stadium"
                    },
                    {
                        id: 22,
                        name: "BD Block Sarbojanin Durgotsab Committee 2025",
                        lat: 22.5950,
                        lng: 88.4060,
                        area: "Salt Lake",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "BD Block Sector I/II traditional Durga Puja celebration",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Traditional customs, Sarbojanin celebration",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Block parking available",
                        nearestMetro: "Salt Lake Stadium"
                    },
                    {
                        id: 23,
                        name: "BJ Block Saradotsav Committee 2025",
                        lat: 22.5912,
                        lng: 88.4264,
                        area: "Salt Lake",
                        location: "kolkata",
                        theme: "Cultural",
                        description: "BJ Block Sector II Saradotsav with cultural programs",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Cultural events, Community programs",
                        rating: 4.2,
                        crowdLevel: "Medium",
                        parkingAvailable: "Block parking available",
                        nearestMetro: "Salt Lake Stadium"
                    },
                    {
                        id: 24,
                        name: "BL Block Durga Puja 2025",
                        lat: 22.5844,
                        lng: 88.4300,
                        area: "Salt Lake",
                        location: "kolkata",
                        theme: "Modern",
                        description: "BL Block Sector II modern Durga Puja celebration",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Modern theme, Youth participation",
                        rating: 4.1,
                        crowdLevel: "Medium",
                        parkingAvailable: "Block parking available",
                        nearestMetro: "Salt Lake Stadium"
                    },
                    {
                        id: 25,
                        name: "Prafulla Kanan Sarbojanin Durgotsab 2025",
                        lat: 22.5955,
                        lng: 88.4240,
                        area: "Salt Lake",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Prafulla Kanan Kestopur area traditional celebration",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Traditional rituals, Garden setting",
                        rating: 4.5,
                        crowdLevel: "Medium",
                        parkingAvailable: "Area parking available",
                        nearestMetro: "Salt Lake Stadium"
                    },
                    // Kalyani Pandals
                    {
                        id: 26,
                        name: "Kalyani ITI More (Luminous Club)",
                        lat: 22.9751,
                        lng: 88.4345,
                        area: "Kalyani",
                        location: "kalyani",
                        theme: "Theme-based",
                        description: "Famous pandal that won Governor's Durga Ratna award for grandeur and visual delight",
                        timings: "24 hours",
                        specialFeatures: "Governor's Durga Ratna award winner, Visual delight",
                        rating: 4.9,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Kalyani Ghoshpara"
                    },
                    {
                        id: 27,
                        name: "Kalyani RathTala Sarbojanin Durga Puja Committee",
                        lat: 22.9801,
                        lng: 88.4298,
                        area: "Kalyani",
                        location: "kalyani",
                        theme: "Traditional",
                        description: "A beautiful pandal which celebrates the spirit of the 5 days",
                        timings: "24 hours",
                        specialFeatures: "Traditional celebrations, Community spirit",
                        rating: 4.7,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking available",
                        nearestMetro: "Kalyani Ghoshpara"
                    },
                    {
                        id: 28,
                        name: "Kalyani C-8 Sarbojanin Durga Puja",
                        lat: 22.9689,
                        lng: 88.4312,
                        area: "Kalyani",
                        location: "kalyani",
                        theme: "Traditional",
                        description: "One of the oldest pandals in Kalyani township, notable for its heritage",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Heritage value, Traditional decorations",
                        rating: 4.5,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Kalyani Ghoshpara"
                    },
                    {
                        id: 29,
                        name: "A-9 Square Park, Kalyani",
                        lat: 22.9823,
                        lng: 88.4356,
                        area: "Kalyani",
                        location: "kalyani",
                        theme: "Modern",
                        description: "Modern pandal with contemporary themes and decorations",
                        timings: "6 AM - 11 PM",
                        specialFeatures: "Modern themes, Contemporary art",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Park available",
                        nearestMetro: "Kalyani Ghoshpara"
                    },
                    {
                        id: 25,
                        name: "Kalyani Boat Park (B-9)",
                        lat: 22.9734,
                        lng: 88.4289,
                        area: "Kalyani",
                        location: "kalyani",
                        theme: "Theme-based",
                        description: "Listed among top 5 pandals in Kalyani for 2024",
                        timings: "24 hours",
                        specialFeatures: "Top-rated pandal, Boat park setting",
                        rating: 4.8,
                        crowdLevel: "High",
                        parkingAvailable: "Ample parking",
                        nearestMetro: "Kalyani Ghoshpara"
                    },
                    {
                        id: 30,
                        name: "Kalyani A-2 Football Ground",
                        lat: 22.9812,
                        lng: 88.4278,
                        area: "Kalyani",
                        location: "kalyani",
                        theme: "Sports",
                        description: "Unique sports-themed pandal at the football ground",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Sports theme, Football ground setting",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Large parking area",
                        nearestMetro: "Kalyani Ghoshpara"
                    },
                    // Chuchura Pandals
                    {
                        id: 31,
                        name: "Chapatola",
                        lat: 22.882869093272767,
                        lng: 88.39036723632421,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Historic pandal in the heart of Chuchura",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Traditional decorations, Heritage location",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 32,
                        name: "Panchanan Tala",
                        lat: 22.882903853779748,
                        lng: 88.39135520748854,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Famous Chuchura pandal with traditional celebrations",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Traditional customs, Community participation",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 33,
                        name: "Shyambabur Ghat",
                        lat: 22.880540525294993,
                        lng: 88.39530424666262,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Riverside pandal with beautiful ghat location",
                        timings: "5 AM - 10 PM",
                        specialFeatures: "Riverside location, Scenic views",
                        rating: 4.6,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 34,
                        name: "Swanderswar Tala",
                        lat: 22.881319997121413,
                        lng: 88.39715212584262,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Historic pandal with traditional architecture",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Historic significance, Traditional art",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 35,
                        name: "Kamar Para",
                        lat: 22.88245427816954,
                        lng: 88.39413782838037,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Local community pandal with traditional celebrations",
                        timings: "6 AM - 10 PM",
                        specialFeatures: "Community spirit, Local traditions",
                        rating: 4.2,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 36,
                        name: "Kanaksali",
                        lat: 22.87991597945041,
                        lng: 88.39093003550116,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Traditional pandal with cultural programs",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Cultural events, Traditional music",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 37,
                        name: "Boloram Goli",
                        lat: 22.882814925307496,
                        lng: 88.39176488264559,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Small but vibrant local pandal",
                        timings: "6 AM - 10 PM",
                        specialFeatures: "Local community, Intimate setting",
                        rating: 4.1,
                        crowdLevel: "Low",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 38,
                        name: "Madhabitola",
                        lat: 22.884684791685007,
                        lng: 88.39723039399564,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Historic pandal with traditional Bengali culture",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Bengali traditions, Cultural heritage",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 39,
                        name: "Choumatha",
                        lat: 22.894905197597794,
                        lng: 88.39107552428284,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Central location pandal with traditional celebrations",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Central location, Easy access",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 40,
                        name: "Ajad Hind Club",
                        lat: 22.89203515596628,
                        lng: 88.40347267865319,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Club organized pandal with good management",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Well organized, Club management",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Club parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 41,
                        name: "Akhan Bajar",
                        lat: 22.890440038510857,
                        lng: 88.39982042468122,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Market area pandal with bustling atmosphere",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Market location, Bustling atmosphere",
                        rating: 4.2,
                        crowdLevel: "High",
                        parkingAvailable: "Market parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 42,
                        name: "Peyara Bagan",
                        lat: 22.896805464571244,
                        lng: 88.39109203393008,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Garden area pandal with natural surroundings",
                        timings: "6 AM - 10 PM",
                        specialFeatures: "Garden setting, Natural beauty",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Garden parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 43,
                        name: "Beguntola",
                        lat: 22.899438578389063,
                        lng: 88.3892728050945,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Traditional pandal with local community involvement",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Community involvement, Local traditions",
                        rating: 4.1,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 44,
                        name: "Karbala",
                        lat: 22.901208860397222,
                        lng: 88.38993730933902,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Historic pandal with cultural significance",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Historic significance, Cultural heritage",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Chuchura"
                    },
                    {
                        id: 41,
                        name: "3 No Gate",
                        lat: 22.8978,
                        lng: 88.3956,
                        area: "Chuchura",
                        location: "chuchura",
                        theme: "Traditional",
                        description: "Gate area pandal with easy accessibility",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Easy access, Gate location",
                        rating: 4.2,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Chuchura"
                    },
                    // Bandel Pandals
                    {
                        id: 45,
                        name: "Ujjal Sangha",
                        lat: 22.9234,
                        lng: 88.3789,
                        area: "Bandel",
                        location: "bandel",
                        theme: "Traditional",
                        description: "Famous Bandel pandal with traditional celebrations",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Heritage location, Traditional customs",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Bandel"
                    },
                    {
                        id: 46,
                        name: "Nabin Sangha",
                        lat: 22.9267,
                        lng: 88.3812,
                        area: "Bandel",
                        location: "bandel",
                        theme: "Traditional",
                        description: "Historic pandal with cultural heritage",
                        timings: "5 AM - 11 PM",
                        specialFeatures: "Cultural heritage, Historic significance",
                        rating: 4.5,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Bandel"
                    },
                    {
                        id: 47,
                        name: "Kailash Nagar",
                        lat: 22.9245,
                        lng: 88.3798,
                        area: "Bandel",
                        location: "bandel",
                        theme: "Traditional",
                        description: "Residential area pandal with community spirit",
                        timings: "6 AM - 10 PM",
                        specialFeatures: "Residential area, Community participation",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Residential parking",
                        nearestMetro: "Bandel"
                    },
                    // Additional Central Kolkata Pandals
                    {
                        id: 45,
                        name: "14 Pally Udayan Sangha",
                        lat: 22.5745,
                        lng: 88.3598,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Popular Central Kolkata pandal with traditional celebrations",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Traditional decorations, Community participation",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Mahatma Gandhi Road"
                    },
                    {
                        id: 46,
                        name: "37 Pally Sarbojanin Durgotsab",
                        lat: 22.5712,
                        lng: 88.3556,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Community-driven pandal in Central Kolkata",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Community involvement, Traditional customs",
                        rating: 4.5,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Mahatma Gandhi Road"
                    },
                    {
                        id: 47,
                        name: "47 Pally Jubak Brinda Durga Puja",
                        lat: 22.5698,
                        lng: 88.3589,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Youth-organized pandal with vibrant celebrations",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Youth participation, Cultural programs",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Mahatma Gandhi Road"
                    },
                    {
                        id: 48,
                        name: "Central Calcutta Youth Association",
                        lat: 22.5681,
                        lng: 88.3634,
                        area: "Central",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Youth association pandal with modern themes",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Youth culture, Modern themes",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Paid parking nearby",
                        nearestMetro: "Chandni Chowk"
                    },
                    {
                        id: 49,
                        name: "Entally Matribhumi Durga Puja",
                        lat: 22.5867,
                        lng: 88.3689,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Famous Entally area pandal with traditional charm",
                        timings: "5 AM - 12 AM",
                        specialFeatures: "Traditional ceremonies, Heritage location",
                        rating: 4.7,
                        crowdLevel: "High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 50,
                        name: "Entally Sarbojanin Sri Sri Durga Puja",
                        lat: 22.5889,
                        lng: 88.3712,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Community pandal in historic Entally area",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Historic area, Community spirit",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 51,
                        name: "Interact Club of Chowringhee High School Sarbojanin Durga Puja",
                        lat: 22.5534,
                        lng: 88.3598,
                        area: "Central",
                        location: "kolkata",
                        theme: "Educational",
                        description: "School-organized pandal with educational themes",
                        timings: "7 AM - 11 PM",
                        specialFeatures: "Educational themes, Student participation",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "School parking",
                        nearestMetro: "Park Street"
                    },
                    {
                        id: 52,
                        name: "Kanai Dhar Lane Adhibasi Brinda",
                        lat: 22.5756,
                        lng: 88.3567,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Lane-based community pandal with local charm",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Local community, Traditional setup",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "No parking",
                        nearestMetro: "Mahatma Gandhi Road"
                    },
                    {
                        id: 53,
                        name: "Machua Bazar Sarbajanik Durga Puja Samity",
                        lat: 22.5823,
                        lng: 88.3634,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Market area pandal with traditional celebrations",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Market area, Traditional decorations",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 54,
                        name: "New Market Sarbojanin Sri Sri Durga Puja",
                        lat: 22.5567,
                        lng: 88.3523,
                        area: "Central",
                        location: "kolkata",
                        theme: "Commercial",
                        description: "Famous New Market area pandal with shopping nearby",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Shopping area, Commercial district",
                        rating: 4.6,
                        crowdLevel: "Very High",
                        parkingAvailable: "Paid parking available",
                        nearestMetro: "Esplanade"
                    },
                    {
                        id: 55,
                        name: "Pallir Yubak Brinda Durga Puja",
                        lat: 22.5734,
                        lng: 88.3612,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Youth group pandal with vibrant atmosphere",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Youth organization, Cultural events",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Mahatma Gandhi Road"
                    },
                    {
                        id: 56,
                        name: "Shishu Palan Foundation",
                        lat: 22.5645,
                        lng: 88.3645,
                        area: "Central",
                        location: "kolkata",
                        theme: "Social",
                        description: "Foundation-organized pandal with social welfare focus",
                        timings: "7 AM - 11 PM",
                        specialFeatures: "Social welfare, Child care activities",
                        rating: 4.5,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Chandni Chowk"
                    },
                    {
                        id: 57,
                        name: "Wellington Nagarik Kalyan Samity Durga Puja",
                        lat: 22.5612,
                        lng: 88.3578,
                        area: "Central",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Civic welfare organization pandal with community focus",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Civic welfare, Community development",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Park Street"
                    },
                    // East Kolkata Pandals
                    {
                        id: 58,
                        name: "Beleghata Sarkar Bazar Durga Puja",
                        lat: 22.5823,
                        lng: 88.3945,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Popular East Kolkata pandal in Beleghata area",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Traditional celebrations, Local community",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 59,
                        name: "Beliaghata 33 Palli Durga Puja",
                        lat: 22.5812,
                        lng: 88.3923,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Community pandal in Beliaghata locality",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Community involvement, Traditional setup",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 60,
                        name: "EKTP Phase 2 Abasik Puja Samity",
                        lat: 22.5756,
                        lng: 88.4123,
                        area: "East",
                        location: "kolkata",
                        theme: "Residential",
                        description: "Residential complex pandal in East Kolkata Township",
                        timings: "6 AM - 11 PM",
                        specialFeatures: "Residential community, Modern setup",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Complex parking",
                        nearestMetro: "New Town"
                    },
                    {
                        id: 61,
                        name: "Jawpur Bayam Samity Durga Puja",
                        lat: 22.5689,
                        lng: 88.4089,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Local samity pandal in Jawpur area",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Local traditions, Community participation",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "New Town"
                    },
                    {
                        id: 62,
                        name: "Judge Bagan Sarbojanin Durgotsab",
                        lat: 22.5534,
                        lng: 88.3867,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Historic Judge Bagan area pandal with heritage charm",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Heritage location, Traditional ceremonies",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 63,
                        name: "Kanjial Para Puja Samity Durga Puja",
                        lat: 22.5645,
                        lng: 88.3998,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Para-based community pandal in East Kolkata",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Para community, Local customs",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "No parking",
                        nearestMetro: "Park Circus"
                    },
                    {
                        id: 64,
                        name: "Nabapally Adhibashi Brinda Durga Puja",
                        lat: 22.5723,
                        lng: 88.4056,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Adhibashi brinda pandal with cultural focus",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Cultural programs, Traditional setup",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Park Circus"
                    },
                    {
                        id: 65,
                        name: "Netaji Sporting Club Durga Puja",
                        lat: 22.5567,
                        lng: 88.3912,
                        area: "East",
                        location: "kolkata",
                        theme: "Sports",
                        description: "Sporting club organized pandal with sports theme",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Sports club, Athletic events",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Club parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 66,
                        name: "Purba Kalikata Sarbojanin Durgotsav",
                        lat: 22.5612,
                        lng: 88.3934,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "East Kolkata regional pandal with grand celebrations",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Regional pandal, Grand decorations",
                        rating: 4.7,
                        crowdLevel: "Very High",
                        parkingAvailable: "Paid parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 67,
                        name: "Purbanchal Prabhati Sangha Durga Puja",
                        lat: 22.5698,
                        lng: 88.4012,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Morning assembly group pandal in eastern area",
                        timings: "5 AM - 12 AM",
                        specialFeatures: "Morning programs, Cultural activities",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Park Circus"
                    },
                    {
                        id: 68,
                        name: "Sixemes Cooperative Housing Durgotsav",
                        lat: 22.5745,
                        lng: 88.4089,
                        area: "East",
                        location: "kolkata",
                        theme: "Residential",
                        description: "Cooperative housing society pandal with modern approach",
                        timings: "6 AM - 11 PM",
                        specialFeatures: "Housing society, Modern facilities",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Society parking",
                        nearestMetro: "New Town"
                    },
                    {
                        id: 69,
                        name: "Sree Sree Durga Puja Committee, Rabindrapally",
                        lat: 22.5534,
                        lng: 88.3845,
                        area: "East",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Rabindrapally area pandal with traditional worship",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Traditional worship, Cultural heritage",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sealdah"
                    },
                    // North Kolkata Pandals - Batch 1
                    {
                        id: 70,
                        name: "31 Pally Sadharan Durgotsab Samity",
                        lat: 22.6156,
                        lng: 88.3698,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Local pally pandal in North Kolkata",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Community participation, Traditional setup",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 71,
                        name: "Ahiritola Jubak Brinda Durga Puja",
                        lat: 22.5923,
                        lng: 88.3567,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Youth group pandal in historic Ahiritola area",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Youth participation, Historic location",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 72,
                        name: "Amherst Sarbojanin Durgotsab",
                        lat: 22.5845,
                        lng: 88.3623,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Amherst Street area pandal with heritage value",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Heritage street, Traditional ceremonies",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 73,
                        name: "Aswiningar Sarbojanin Durgotsav",
                        lat: 22.6123,
                        lng: 88.3745,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Community pandal in Aswiningar locality",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Local community, Traditional customs",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "No parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 74,
                        name: "Baghbazar Palli Puja O Pradarshani",
                        lat: 22.5967,
                        lng: 88.3634,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Famous Baghbazar area pandal with exhibition",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Exhibition, Traditional art",
                        rating: 4.7,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    {
                        id: 75,
                        name: "Bandhudal Durgotsob",
                        lat: 22.6089,
                        lng: 88.3712,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Brotherhood group pandal in North Kolkata",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Brotherhood theme, Community unity",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 76,
                        name: "Beadon Street Sarbojanin Durgotsav",
                        lat: 22.5812,
                        lng: 88.3598,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Historic Beadon Street pandal with traditional charm",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Historic street, Traditional setup",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 77,
                        name: "Belgachia Sadharan Durgotsab",
                        lat: 22.6234,
                        lng: 88.3812,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Community pandal in Belgachia area",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Community involvement, Traditional customs",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Belgachia"
                    },
                    {
                        id: 78,
                        name: "Belgachia Yuba Sammilani Durga Puja",
                        lat: 22.6245,
                        lng: 88.3834,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Youth assembly pandal in Belgachia",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Youth assembly, Cultural programs",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Belgachia"
                    },
                    {
                        id: 79,
                        name: "Bhagabati Park Durga Puja Committee",
                        lat: 22.6012,
                        lng: 88.3687,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Park-based pandal with spacious setup",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Park location, Open space",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Park parking",
                        nearestMetro: "Shyama Charan"
                    },
                    // North Kolkata Pandals - Batch 2
                    {
                        id: 80,
                        name: "Bharatiya Tarun Sangha Durga Puja",
                        lat: 22.5978,
                        lng: 88.3654,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Youth organization pandal with patriotic theme",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Youth organization, Patriotic theme",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    {
                        id: 81,
                        name: "Biswanath Apartment Sharodutsab",
                        lat: 22.6067,
                        lng: 88.3723,
                        area: "North",
                        location: "kolkata",
                        theme: "Residential",
                        description: "Apartment complex pandal with modern setup",
                        timings: "6 AM - 11 PM",
                        specialFeatures: "Apartment complex, Modern facilities",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Apartment parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 82,
                        name: "Brindaban Matri Mandir Durga Puja",
                        lat: 22.5934,
                        lng: 88.3589,
                        area: "North",
                        location: "kolkata",
                        theme: "Religious",
                        description: "Temple-based pandal with religious significance",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Temple location, Religious ceremonies",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Temple parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 83,
                        name: "Calcutta Youth Forum",
                        lat: 22.5856,
                        lng: 88.3612,
                        area: "North",
                        location: "kolkata",
                        theme: "Modern",
                        description: "Youth forum pandal with contemporary themes",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Youth forum, Contemporary themes",
                        rating: 4.4,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 84,
                        name: "Campbagan Sadharan Durgotsav",
                        lat: 22.6145,
                        lng: 88.3756,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Campbagan area pandal with traditional setup",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Traditional setup, Local community",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 85,
                        name: "Chaltabagan Lohapatty Durga Puja",
                        lat: 22.5923,
                        lng: 88.3545,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Chaltabagan area pandal in historic locality",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Historic locality, Traditional customs",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 86,
                        name: "Charer Palli Sarbojanin Durgotsab",
                        lat: 22.6089,
                        lng: 88.3689,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Char area community pandal with river proximity",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "River proximity, Community involvement",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "No parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 87,
                        name: "Chorebagan Sarbojanin Durgotsab Samity",
                        lat: 22.5945,
                        lng: 88.3567,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Chorebagan area pandal with heritage value",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Heritage area, Traditional ceremonies",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 88,
                        name: "Cossipore Shakti Sangha Durga Puja",
                        lat: 22.6267,
                        lng: 88.3745,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Cossipore area pandal with Shakti worship focus",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Shakti worship, Traditional rituals",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Cossipore"
                    },
                    {
                        id: 89,
                        name: "Dakshin Rabindrapally Sarbojanin Durga Puja",
                        lat: 22.5512,
                        lng: 88.3823,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "South Rabindrapally area pandal with cultural focus",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Cultural focus, Community participation",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    // North Kolkata Pandals - Batch 3 (continuing with the large list)
                    {
                        id: 90,
                        name: "Darjeepara Sarbojanin Durgotsab Samity",
                        lat: 22.6156,
                        lng: 88.3723,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Darjeepara area community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Community samity, Traditional setup",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 91,
                        name: "Deshbandhunagar Sarbojanin Durgotsab",
                        lat: 22.6123,
                        lng: 88.3689,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Patriotic themed pandal in Deshbandhunagar",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Patriotic theme, Community involvement",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 92,
                        name: "Dum Dum Park Bharat Chakra Durga Puja",
                        lat: 22.6298,
                        lng: 88.4012,
                        area: "North",
                        location: "kolkata",
                        theme: "Patriotic",
                        description: "Patriotic themed pandal in Dum Dum Park",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Patriotic theme, Park location",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Park parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 93,
                        name: "Dum Dum Park Sarbojanin Durga Puja",
                        lat: 22.6312,
                        lng: 88.4034,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Community pandal in Dum Dum Park area",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Park area, Community participation",
                        rating: 4.7,
                        crowdLevel: "Very High",
                        parkingAvailable: "Park parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 94,
                        name: "Durbar Mahila Samanya Committee",
                        lat: 22.5834,
                        lng: 88.3634,
                        area: "North",
                        location: "kolkata",
                        theme: "Women Empowerment",
                        description: "Women's committee pandal with empowerment theme",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Women empowerment, Social awareness",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 95,
                        name: "Garden Lane Sarbojanin Durgotsab",
                        lat: 22.5912,
                        lng: 88.3612,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Garden Lane area pandal with green theme",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Green theme, Lane community",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 96,
                        name: "Goabagan Sarodatsav Sammilani Durga Puja",
                        lat: 22.5998,
                        lng: 88.3678,
                        area: "North",
                        location: "kolkata",
                        theme: "Cultural",
                        description: "Cultural festival pandal in Goabagan",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Cultural festival, Music programs",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Shyama Charan"
                    },
                    {
                        id: 97,
                        name: "Golaghata Sammilani Durga Puja",
                        lat: 22.6045,
                        lng: 88.3734,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Golaghata area assembly pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Assembly group, Traditional customs",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "No parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 98,
                        name: "Grey Street Sarbojanin Durga Puja",
                        lat: 22.5823,
                        lng: 88.3589,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Grey Street area pandal with street community",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Street community, Traditional setup",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 99,
                        name: "Halsibagan Sarbojanin Durgotsab",
                        lat: 22.6234,
                        lng: 88.3789,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Halsibagan area community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Local community, Traditional celebrations",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Belgachia"
                    },
                    // North Kolkata Pandals - Final Batch (Key remaining pandals)
                    {
                        id: 100,
                        name: "Hari Ghosh Street Sarbojanin",
                        lat: 22.5889,
                        lng: 88.3645,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Historic Hari Ghosh Street pandal",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Historic street, Traditional ceremonies",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 101,
                        name: "Kumartuli Park Sarbojanin Durgotsab Committee",
                        lat: 22.5945,
                        lng: 88.3689,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Kumartuli potter's area pandal with traditional craftsmanship",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Potter's area, Traditional idol making",
                        rating: 4.8,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    {
                        id: 102,
                        name: "Kumartuli Sarbojanin Durgotsab",
                        lat: 22.5956,
                        lng: 88.3698,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Another famous Kumartuli area pandal",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Traditional art, Idol making heritage",
                        rating: 4.7,
                        crowdLevel: "Very High",
                        parkingAvailable: "No parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    {
                        id: 103,
                        name: "Shyambazar Nabin Sangha Durga Puja",
                        lat: 22.5867,
                        lng: 88.3567,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Famous Shyambazar area pandal with heritage value",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Heritage area, Traditional customs",
                        rating: 4.7,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited street parking",
                        nearestMetro: "Shyambazar"
                    },
                    {
                        id: 104,
                        name: "Sovabazar Sarbojanin Durgotsav",
                        lat: 22.5823,
                        lng: 88.3534,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Historic Sovabazar area pandal with royal heritage",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Royal heritage, Historic significance",
                        rating: 4.8,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 105,
                        name: "Sreebhumi Sporting Club Durga Puja",
                        lat: 22.6456,
                        lng: 88.4123,
                        area: "North",
                        location: "kolkata",
                        theme: "Theme-based",
                        description: "Famous Sreebhumi sporting club with grand themes",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Grand themes, Sporting club",
                        rating: 4.9,
                        crowdLevel: "Very High",
                        parkingAvailable: "Club parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 106,
                        name: "Tala Barowari Durgotsab",
                        lat: 22.6089,
                        lng: 88.3656,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Tala area community pandal with local charm",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Local community, Traditional setup",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 107,
                        name: "Ultadanga Jagarani Sangha Durga Puja",
                        lat: 22.5734,
                        lng: 88.3934,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Ultadanga area awakening group pandal",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Awakening theme, Community spirit",
                        rating: 4.6,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Ultadanga"
                    },
                    {
                        id: 108,
                        name: "Ultadanga Pallyshree Durga Puja",
                        lat: 22.5745,
                        lng: 88.3912,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Ultadanga neighborhood beauty pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Neighborhood beauty, Community pride",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Ultadanga"
                    },
                    {
                        id: 109,
                        name: "Young Citizens Club Durga Puja",
                        lat: 22.5978,
                        lng: 88.3623,
                        area: "North",
                        location: "kolkata",
                        theme: "Modern",
                        description: "Young citizens club with modern approach",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Young citizens, Modern themes",
                        rating: 4.4,
                        crowdLevel: "High",
                        parkingAvailable: "Club parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    // Additional North Kolkata Pandals - Missing from previous batch
                    {
                        id: 110,
                        name: "Lake View Park Sarbojanin Durgotsav Samity",
                        lat: 22.6123,
                        lng: 88.3812,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Lake view park pandal with scenic beauty",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Lake view, Park setting",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Park parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 111,
                        name: "Mahalla Sarbojanin Durgautsab Samity",
                        lat: 22.5934,
                        lng: 88.3612,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Mahalla community pandal with local traditions",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Mahalla community, Local traditions",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 112,
                        name: "Mitali Kankurgachi Durga Puja",
                        lat: 22.5756,
                        lng: 88.3923,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Friendship themed pandal in Kankurgachi area",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Friendship theme, Community bonding",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Ultadanga"
                    },
                    {
                        id: 113,
                        name: "Mohan Bagan Barwari Durga Puja",
                        lat: 22.6034,
                        lng: 88.3689,
                        area: "North",
                        location: "kolkata",
                        theme: "Sports",
                        description: "Famous Mohan Bagan area pandal with football heritage",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Football heritage, Sports theme",
                        rating: 4.7,
                        crowdLevel: "Very High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Shyama Charan"
                    },
                    {
                        id: 114,
                        name: "Mondal Para Sporting Club Durga Puja",
                        lat: 22.6012,
                        lng: 88.3712,
                        area: "North",
                        location: "kolkata",
                        theme: "Sports",
                        description: "Sporting club pandal in Mondal Para area",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Sporting club, Athletic activities",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Club parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 115,
                        name: "Nainan Para & Jogendra Basak Road Sarbojanin Shree Shree Durgapuja",
                        lat: 22.5889,
                        lng: 88.3678,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Joint para pandal on Jogendra Basak Road",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Joint para initiative, Traditional worship",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 116,
                        name: "Nalin Sarkar Street Sarbojanin Durgotsab",
                        lat: 22.5823,
                        lng: 88.3612,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Nalin Sarkar Street community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Street community, Traditional setup",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 117,
                        name: "Nimta Boy's Athletic Club Sarbojanin Durgotsav",
                        lat: 22.6434,
                        lng: 88.4156,
                        area: "North",
                        location: "kolkata",
                        theme: "Sports",
                        description: "Boys' athletic club pandal in Nimta",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Athletic club, Youth sports",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Club parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 118,
                        name: "Nimtala Sarbojanin Durgotsab",
                        lat: 22.5912,
                        lng: 88.3534,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Nimtala area community pandal with heritage",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Heritage area, Traditional ceremonies",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 119,
                        name: "North Tangra Durga Puja",
                        lat: 22.5645,
                        lng: 88.3934,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "North Tangra area pandal with Chinese community influence",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Multicultural area, Community harmony",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Park Circus"
                    },
                    {
                        id: 120,
                        name: "North Tridhara Sarbojanin Durga Puja",
                        lat: 22.6089,
                        lng: 88.3734,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "North Tridhara area three-stream community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Three-stream community, Unity theme",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 121,
                        name: "Nutan Pally Sarbojanin Durgotsab",
                        lat: 22.6156,
                        lng: 88.3756,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "New neighborhood community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "New neighborhood, Modern community",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 122,
                        name: "Pathuria Ghata Pancher Palli Sarbojanin",
                        lat: 22.5945,
                        lng: 88.3512,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Pathuria Ghata five-neighborhood joint pandal",
                        timings: "5 AM - 1 AM",
                        specialFeatures: "Five neighborhoods, Joint initiative",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 123,
                        name: "Ramesh Dutta Street Sarbojanin Durgotsab",
                        lat: 22.5867,
                        lng: 88.3589,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Ramesh Dutta Street community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Street community, Traditional customs",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 124,
                        name: "Rammohan Sammilani Durga Puja",
                        lat: 22.5834,
                        lng: 88.3567,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Rammohan assembly pandal with social reform theme",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Social reform theme, Educational focus",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sealdah"
                    },
                    {
                        id: 125,
                        name: "Sadhukhan Bari Durga Puja",
                        lat: 22.5912,
                        lng: 88.3623,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Sadhukhan house pandal with family traditions",
                        timings: "6 AM - 11 PM",
                        specialFeatures: "Family traditions, House pandal",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Sovabazar-Sutanuti"
                    },
                    {
                        id: 126,
                        name: "Sammilita Lalabagan Sarbojanin Durga Puja",
                        lat: 22.6023,
                        lng: 88.3698,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "United Lalabagan area community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "United community, Lalabagan area",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Shyama Charan"
                    },
                    {
                        id: 127,
                        name: "Sarkar Bagan Sammilita Sangha Durga Puja",
                        lat: 22.5978,
                        lng: 88.3645,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Sarkar Bagan united association pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "United association, Community harmony",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Shobhabazar-Sutanuti"
                    },
                    {
                        id: 128,
                        name: "Sater Palli Sarbojanin Durgotsav",
                        lat: 22.6145,
                        lng: 88.3712,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Sater Palli seven-neighborhood community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Seven neighborhoods, Community unity",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 129,
                        name: "Signum Aristo Residential Puja",
                        lat: 22.6234,
                        lng: 88.3867,
                        area: "North",
                        location: "kolkata",
                        theme: "Residential",
                        description: "Residential complex pandal with modern amenities",
                        timings: "6 AM - 11 PM",
                        specialFeatures: "Residential complex, Modern amenities",
                        rating: 4.2,
                        crowdLevel: "Low",
                        parkingAvailable: "Complex parking",
                        nearestMetro: "Belgachia"
                    },
                    {
                        id: 130,
                        name: "Sikdar Bagan Sadharan Durgotsov",
                        lat: 22.6067,
                        lng: 88.3678,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Sikdar Bagan general community celebration",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "General community, Traditional celebration",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 131,
                        name: "Simla Sporting Club Durga Puja",
                        lat: 22.6012,
                        lng: 88.3734,
                        area: "North",
                        location: "kolkata",
                        theme: "Sports",
                        description: "Simla sporting club pandal with hill station theme",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Hill station theme, Sporting activities",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Club parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 132,
                        name: "Tala Dakshin Pally Durgotsav Committee",
                        lat: 22.6078,
                        lng: 88.3645,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "South Tala neighborhood pandal committee",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "South Tala, Neighborhood committee",
                        rating: 4.4,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 133,
                        name: "Tala Park 15 Pally Durga Puja",
                        lat: 22.6098,
                        lng: 88.3667,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Tala Park 15 neighborhood pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Park area, 15 neighborhoods",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Park parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 134,
                        name: "Telengabagan Sarbojanin Durgotsab",
                        lat: 22.6189,
                        lng: 88.3789,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Telengabagan area community pandal",
                        timings: "6 AM - 12 AM",
                        specialFeatures: "Local community, Traditional setup",
                        rating: 4.3,
                        crowdLevel: "Medium",
                        parkingAvailable: "Street parking",
                        nearestMetro: "Dum Dum"
                    },
                    {
                        id: 135,
                        name: "Ultadanga Sangrami Durga Puja",
                        lat: 22.5723,
                        lng: 88.3889,
                        area: "North",
                        location: "kolkata",
                        theme: "Traditional",
                        description: "Ultadanga struggle-themed community pandal",
                        timings: "6 AM - 1 AM",
                        specialFeatures: "Struggle theme, Community resistance",
                        rating: 4.5,
                        crowdLevel: "High",
                        parkingAvailable: "Limited parking",
                        nearestMetro: "Ultadanga"
                    }
                ];

                // Filter pandals based on selected location
                if (this.selectedLocation) {
                    this.pandals = allPandals.filter(pandal => {
                        // If pandal has location field, use it; otherwise assume kolkata
                        const pandalLocation = pandal.location || 'kolkata';
                        return pandalLocation === this.selectedLocation;
                    });
                } else {
                    this.pandals = allPandals; // Show all if no location selected
                }
                
                console.log(`Loaded ${this.pandals.length} pandals for location: ${this.selectedLocation || 'all'}`);
            }

            initMap() {
                // Initialize map centered on Kolkata
                this.map = L.map('map').setView([22.5726, 88.3639], 12);

                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(this.map);

                // Add pandal markers
                this.addPandalMarkers();
            }

            clearMap() {
                // Remove all existing markers
                this.markers.forEach(marker => {
                    this.map.removeLayer(marker);
                });
                this.markers = [];
                
                // Clear any existing route lines
                if (this.routeControl) {
                    this.map.removeControl(this.routeControl);
                    this.routeControl = null;
                }
                
                // Clear route polylines if they exist
                if (this.routePolylines) {
                    this.routePolylines.forEach(line => this.map.removeLayer(line));
                    this.routePolylines = [];
                }
                
                // Clear styled segments
                if (this.styledSegments) {
                    this.styledSegments.forEach(segment => this.map.removeLayer(segment));
                    this.styledSegments = [];
                }
            }

            addPandalMarkers() {
                this.pandals.forEach(pandal => {
                    const marker = L.marker([pandal.lat, pandal.lng])
                        .addTo(this.map)
                        .bindPopup(this.createPopupContent(pandal));

                    // Store reference for later use
                    marker.pandalData = pandal;
                    this.markers.push(marker);

                    // Add click event for route planning
                    marker.on('click', () => {
                        this.selectPandalForRoute(pandal);
                    });
                });
            }

            createPopupContent(pandal) {
                return `
                    <div class="custom-popup">
                        <h3>${pandal.name}</h3>
                        <p><strong>Area:</strong> ${pandal.area} Kolkata</p>
                        <p><strong>Timings:</strong> ${pandal.timings}</p>
                        <p><strong>Crowd Level:</strong> ${pandal.crowdLevel}</p>
                        <p><strong>Rating:</strong> ⭐ ${pandal.rating}/5</p>
                        <p><strong>Nearest Metro:</strong> ${pandal.nearestMetro}</p>
                        <p><strong>Parking:</strong> ${pandal.parkingAvailable}</p>
                        <div class="theme-tag">${pandal.theme}</div>
                        <br><br>
                        <button onclick="window.app.addToRoute(${pandal.id})" style="background: #4caf50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                            Add to Route
                        </button>
                    </div>
                `;
            }

            renderPandalCards() {
                const container = document.getElementById('pandal-cards');
                container.innerHTML = '';

                // Group pandals by area
                const pandalsByArea = {};
                this.pandals.forEach(pandal => {
                    if (!pandalsByArea[pandal.area]) {
                        pandalsByArea[pandal.area] = [];
                    }
                    pandalsByArea[pandal.area].push(pandal);
                });

                // Define the order of areas (Kalyani first, then others)
                const areaOrder = ['Kalyani', 'Salt Lake', 'Chuchura', 'Bandel', 'North', 'Central', 'South', 'East', 'West'];
                
                areaOrder.forEach(area => {
                    if (pandalsByArea[area]) {
                        // Create area header
                        const areaHeader = document.createElement('div');
                        areaHeader.style.cssText = `
                            background: linear-gradient(135deg, #d32f2f 0%, #f57c00 100%);
                            color: white;
                            padding: 10px 15px;
                            margin: 20px 0 10px 0;
                            border-radius: 8px;
                            font-weight: bold;
                            font-size: 16px;
                            text-align: center;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        `;
                        
                        let areaTitle = area;
                        if (area === 'Kalyani') {
                            areaTitle = '🏆 Kalyani Special';
                        } else {
                            areaTitle = `${area} Kolkata`;
                        }
                        
                        areaHeader.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${areaTitle}`;
                        container.appendChild(areaHeader);

                        // Add pandals for this area
                        pandalsByArea[area].forEach(pandal => {
                            const card = document.createElement('div');
                            card.className = 'pandal-card';
                            
                            // Special styling for Kalyani pandals
                            if (area === 'Kalyani') {
                                card.style.border = '2px solid #ff6b6b';
                                card.style.background = 'linear-gradient(135deg, #fff8f0 0%, #ffffff 100%)';
                            }
                            
                            // Add distance info if user location is available
                            const distanceInfo = this.userLocation ? 
                                `<p><i class="fas fa-route"></i> ${this.calculateDistance(this.userLocation, pandal).toFixed(1)} km away</p>` : '';
                            
                            card.innerHTML = `
                                <div class="rating">⭐ ${pandal.rating}</div>
                                <h4>${pandal.name}</h4>
                                <p><i class="fas fa-map-marker-alt"></i> ${pandal.area}${pandal.area !== 'Kalyani' ? ' Kolkata' : ''}</p>
                                <p><i class="fas fa-clock"></i> ${pandal.timings}</p>
                                <p><i class="fas fa-users"></i> ${pandal.crowdLevel} crowd</p>
                                <p><i class="fas fa-subway"></i> ${pandal.nearestMetro}</p>
                                ${distanceInfo}
                                <div class="theme">${pandal.theme}</div>
                                <div style="margin-top: 10px; display: flex; gap: 5px;">
                                    <button onclick="window.app.focusOnPandal(${pandal.id})" 
                                            style="background: #2196f3; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; flex: 1;">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button onclick="window.app.quickAddToRoute(${pandal.id})" 
                                            style="background: #4caf50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; flex: 1;">
                                        <i class="fas fa-plus"></i> Add to Route
                                    </button>
                                </div>
                            `;

                            container.appendChild(card);
                        });
                    }
                });
            }

            filterPandals() {
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                const areaFilter = document.getElementById('area-filter').value;
                const themeFilter = document.getElementById('theme-filter').value;

                const filteredPandals = this.pandals.filter(pandal => {
                    const matchesSearch = pandal.name.toLowerCase().includes(searchTerm) ||
                                        pandal.area.toLowerCase().includes(searchTerm);
                    const matchesArea = !areaFilter || pandal.area === areaFilter;
                    const matchesTheme = !themeFilter || pandal.theme === themeFilter;

                    return matchesSearch && matchesArea && matchesTheme;
                });

                // Hide all markers
                this.markers.forEach(marker => {
                    this.map.removeLayer(marker);
                });

                // Show filtered markers
                this.markers.forEach(marker => {
                    if (filteredPandals.some(p => p.id === marker.pandalData.id)) {
                        this.map.addLayer(marker);
                    }
                });

                // Update pandal cards
                this.renderFilteredCards(filteredPandals);
            }

            renderFilteredCards(pandals) {
                const container = document.getElementById('pandal-cards');
                container.innerHTML = '';

                // Group filtered pandals by area
                const pandalsByArea = {};
                pandals.forEach(pandal => {
                    if (!pandalsByArea[pandal.area]) {
                        pandalsByArea[pandal.area] = [];
                    }
                    pandalsByArea[pandal.area].push(pandal);
                });

                // Define the order of areas (Kalyani first, then others)
                const areaOrder = ['Kalyani', 'Chuchura', 'Bandel', 'North', 'Central', 'South', 'East', 'West'];
                
                areaOrder.forEach(area => {
                    if (pandalsByArea[area]) {
                        // Create area header
                        const areaHeader = document.createElement('div');
                        areaHeader.style.cssText = `
                            background: linear-gradient(135deg, #d32f2f 0%, #f57c00 100%);
                            color: white;
                            padding: 10px 15px;
                            margin: 20px 0 10px 0;
                            border-radius: 8px;
                            font-weight: bold;
                            font-size: 16px;
                            text-align: center;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        `;
                        
                        let areaTitle = area;
                        if (area === 'Kalyani') {
                            areaTitle = '🏆 Kalyani Special';
                        } else {
                            areaTitle = `${area} Kolkata`;
                        }
                        
                        areaHeader.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${areaTitle}`;
                        container.appendChild(areaHeader);

                        // Add pandals for this area
                        pandalsByArea[area].forEach(pandal => {
                            const card = document.createElement('div');
                            card.className = 'pandal-card';
                            
                            // Special styling for Kalyani pandals
                            if (area === 'Kalyani') {
                                card.style.border = '2px solid #ff6b6b';
                                card.style.background = 'linear-gradient(135deg, #fff8f0 0%, #ffffff 100%)';
                            }
                            
                            // Add distance info if user location is available
                            const distanceInfo = this.userLocation ? 
                                `<p><i class="fas fa-route"></i> ${this.calculateDistance(this.userLocation, pandal).toFixed(1)} km away</p>` : '';
                            
                            card.innerHTML = `
                                <div class="rating">⭐ ${pandal.rating}</div>
                                <h4>${pandal.name}</h4>
                                <p><i class="fas fa-map-marker-alt"></i> ${pandal.area}${pandal.area !== 'Kalyani' ? ' Kolkata' : ''}</p>
                                <p><i class="fas fa-clock"></i> ${pandal.timings}</p>
                                <p><i class="fas fa-users"></i> ${pandal.crowdLevel} crowd</p>
                                <p><i class="fas fa-subway"></i> ${pandal.nearestMetro}</p>
                                ${distanceInfo}
                                <div class="theme">${pandal.theme}</div>
                                <div style="margin-top: 10px; display: flex; gap: 5px;">
                                    <button onclick="window.app.focusOnPandal(${pandal.id})" 
                                            style="background: #2196f3; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; flex: 1;">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button onclick="window.app.quickAddToRoute(${pandal.id})" 
                                            style="background: #4caf50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; flex: 1;">
                                        <i class="fas fa-plus"></i> Add to Route
                                    </button>
                                </div>
                            `;

                            container.appendChild(card);
                        });
                    }
                });
            }

            showAllPandals() {
                // Reset filters
                document.getElementById('search-input').value = '';
                document.getElementById('area-filter').value = '';
                document.getElementById('theme-filter').value = '';

                // Show all markers
                this.markers.forEach(marker => {
                    if (!this.map.hasLayer(marker)) {
                        this.map.addLayer(marker);
                    }
                });

                // Reset view
                this.map.setView([22.5726, 88.3639], 12);
                
                // Render all cards
                this.renderPandalCards();
            }

            selectPandalForRoute(pandal) {
                if (!this.selectedPandals.find(p => p.id === pandal.id)) {
                    this.selectedPandals.push(pandal);
                    this.updateSelectedPandals();
                }
            }

            addToRoute(pandalId) {
                const pandal = this.pandals.find(p => p.id === pandalId);
                if (pandal && !this.selectedPandals.find(p => p.id === pandalId)) {
                    this.selectedPandals.push(pandal);
                    this.updateSelectedPandals();
                }
            }

            updateSelectedPandals() {
                const container = document.getElementById('selected-pandals');
                container.innerHTML = '';

                this.selectedPandals.forEach((pandal, index) => {
                    const div = document.createElement('div');
                    div.className = 'selected-pandal';
                    div.innerHTML = `
                        <span>${index + 1}. ${pandal.name}</span>
                        <button class="remove-pandal" onclick="window.app.removePandal(${pandal.id})">×</button>
                    `;
                    container.appendChild(div);
                });
            }

            removePandal(pandalId) {
                this.selectedPandals = this.selectedPandals.filter(p => p.id !== pandalId);
                this.updateSelectedPandals();
                
                if (this.routeControl) {
                    this.map.removeControl(this.routeControl);
                    this.routeControl = null;
                }
            }

            optimizeRoute() {
                if (this.selectedPandals.length < 2) {
                    alert('Please select at least 2 pandals for route optimization.');
                    return;
                }

                // Simple route optimization using distance (TSP approximation)
                const optimized = this.tspApproximation(this.selectedPandals);
                this.selectedPandals = optimized;
                this.updateSelectedPandals();
                
                // Create route visualization
                this.createRoute();
                this.displayRouteInfo();
            }

            tspApproximation(pandals) {
                if (pandals.length <= 2) return pandals;
                
                console.log('Optimizing route for', pandals.length, 'pandals...');
                
                // Try different starting points and find the best route
                let bestRoute = null;
                let bestDistance = Infinity;
                
                // If user location is available, start from there
                if (this.userLocation) {
                    const userPoint = { lat: this.userLocation.lat, lng: this.userLocation.lng, name: 'Your Location' };
                    bestRoute = this.nearestNeighborTSP(pandals, userPoint);
                    bestDistance = this.calculateTotalRouteDistance(bestRoute);
                } else {
                    // Try starting from each pandal and pick the best route
                    for (let i = 0; i < Math.min(pandals.length, 5); i++) { // Limit to 5 starting points for performance
                        const route = this.nearestNeighborTSP(pandals, pandals[i]);
                        const distance = this.calculateTotalRouteDistance(route);
                        
                        if (distance < bestDistance) {
                            bestDistance = distance;
                            bestRoute = route;
                        }
                    }
                }
                
                // Apply 2-opt improvement to the best route
                const optimizedRoute = this.twoOptImprovement(bestRoute);
                const finalDistance = this.calculateTotalRouteDistance(optimizedRoute);
                
                console.log(`Route optimized: ${bestDistance.toFixed(2)}km → ${finalDistance.toFixed(2)}km (${((bestDistance - finalDistance) / bestDistance * 100).toFixed(1)}% improvement)`);
                
                return optimizedRoute;
            }
            
            nearestNeighborTSP(pandals, startPoint) {
                let optimized = [];
                let remaining = [...pandals];
                let current = startPoint;
                
                // If startPoint is not in pandals list, add it as starting point
                if (!pandals.find(p => p.id === startPoint.id)) {
                    // Don't add user location to the route, just use it as reference
                    if (startPoint.name !== 'Your Location') {
                        optimized = [startPoint];
                        remaining = remaining.filter(p => p.id !== startPoint.id);
                    }
                }

                while (remaining.length > 0) {
                    let nearest = remaining[0];
                    let minDistance = this.calculateDistance(current, nearest);

                    remaining.forEach(pandal => {
                        const distance = this.calculateDistance(current, pandal);
                        if (distance < minDistance) {
                            minDistance = distance;
                            nearest = pandal;
                        }
                    });

                    optimized.push(nearest);
                    remaining = remaining.filter(p => p.id !== nearest.id);
                    current = nearest;
                }

                return optimized;
            }
            
            twoOptImprovement(route) {
                if (route.length < 4) return route;
                
                let improved = [...route];
                let bestDistance = this.calculateTotalRouteDistance(improved);
                let foundImprovement = true;
                
                while (foundImprovement) {
                    foundImprovement = false;
                    
                    for (let i = 1; i < route.length - 2; i++) {
                        for (let j = i + 1; j < route.length; j++) {
                            // Create new route by reversing the segment between i and j
                            const newRoute = [
                                ...improved.slice(0, i),
                                ...improved.slice(i, j + 1).reverse(),
                                ...improved.slice(j + 1)
                            ];
                            
                            const newDistance = this.calculateTotalRouteDistance(newRoute);
                            
                            if (newDistance < bestDistance) {
                                improved = newRoute;
                                bestDistance = newDistance;
                                foundImprovement = true;
                            }
                        }
                    }
                }
                
                return improved;
            }
            
            calculateTotalRouteDistance(route) {
                let totalDistance = 0;
                for (let i = 0; i < route.length - 1; i++) {
                    totalDistance += this.calculateDistance(route[i], route[i + 1]);
                }
                return totalDistance;
            }

            calculateDistance(p1, p2) {
                const R = 6371; // Earth's radius in km
                const dLat = (p2.lat - p1.lat) * Math.PI / 180;
                const dLng = (p2.lng - p1.lng) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                          Math.cos(p1.lat * Math.PI / 180) * Math.cos(p2.lat * Math.PI / 180) *
                          Math.sin(dLng/2) * Math.sin(dLng/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            }

            setTransportMode(mode) {
                this.transportMode = mode;
                
                // Update UI to show active mode
                document.querySelectorAll('.transport-mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (mode === 'foot') {
                    document.getElementById('mode-walking').classList.add('active');
                } else if (mode === 'driving') {
                    document.getElementById('mode-driving').classList.add('active');
                } else if (mode === 'cycling') {
                    document.getElementById('mode-cycling').classList.add('active');
                }
                
                console.log('Transport mode changed to:', mode);
                
                // If route is already created, recreate it with new transport mode
                if (this.selectedPandals.length > 1) {
                    this.createRoute();
                }
                
                // If navigation is active, update current route
                if (this.isRouteActive) {
                    this.createRouteVisualization();
                }
            }

            createRoute() {
                // Clear existing route control
                if (this.routeControl) {
                    this.map.removeControl(this.routeControl);
                    this.routeControl = null;
                }
                
                // Clear existing route lines
                this.routePolylines.forEach(line => this.map.removeLayer(line));
                this.routePolylines = [];

                if (this.selectedPandals.length < 2) {
                    alert('Please select at least 2 pandals to create a route!');
                    return;
                }

                // Create waypoints array for road-based routing
                const waypoints = this.selectedPandals.map(pandal => 
                    L.latLng(pandal.lat, pandal.lng)
                );

                // Create road-based routing using Leaflet Routing Machine
                this.routeControl = L.Routing.control({
                    waypoints: waypoints,
                    routeWhileDragging: false,
                    addWaypoints: false,
                    draggableWaypoints: false,
                    createMarker: function(i, waypoint, n) {
                        // Create custom numbered markers
                        const app = window.app;
                        const pandal = app.selectedPandals[i];
                        
                        const numberIcon = L.divIcon({
                            html: `<div style="background: #ff6b6b; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">${i + 1}</div>`,
                            iconSize: [30, 30],
                            className: 'custom-number-icon'
                        });

                        return L.marker(waypoint.latLng, { 
                            icon: numberIcon,
                            title: pandal ? pandal.name : `Stop ${i + 1}`
                        }).bindPopup(pandal ? `${i + 1}. ${pandal.name}<br><small>${pandal.description}</small>` : `Stop ${i + 1}`);
                    },
                    router: L.Routing.osrmv1({
                        serviceUrl: 'https://router.project-osrm.org/route/v1',
                        profile: this.transportMode // Use selected transport mode
                    }),
                    lineOptions: {
                        styles: [
                            {color: '#ff6b6b', opacity: 0.8, weight: 6},
                            {color: 'white', opacity: 0.8, weight: 4}
                        ]
                    },
                    show: false, // Hide the default instruction panel
                    summaryTemplate: '<div class="routing-summary"><h3><i class="fas fa-route"></i> Route Summary</h3>{name}: {distance}, {time}</div>'
                }).addTo(this.map);

                // Store total distance and time for the route
                this.routeControl.on('routesfound', (e) => {
                    const routes = e.routes;
                    const summary = routes[0].summary;
                    
                    // Convert distance from meters to kilometers
                    const distanceKm = (summary.totalDistance / 1000).toFixed(1);
                    const timeMinutes = Math.round(summary.totalTime / 60);
                    
                    console.log(`Route calculated: ${distanceKm} km, ${timeMinutes} minutes`);
                    
                    // Update route info display
                    this.displayAdvancedRouteInfo(distanceKm, timeMinutes, routes[0]);
                });

                // Add route optimization information
                this.displayRouteOptimizationInfo();
            }

            displayRouteInfo() {
                let totalDistance = 0;
                for (let i = 0; i < this.selectedPandals.length - 1; i++) {
                    totalDistance += this.calculateDistance(
                        this.selectedPandals[i], 
                        this.selectedPandals[i + 1]
                    );
                }

                const estimatedTime = Math.ceil(totalDistance * 10 + this.selectedPandals.length * 30); // 10 min per km + 30 min per pandal

                const routeInfo = document.getElementById('route-info');
                routeInfo.innerHTML = `
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h4><i class="fas fa-route"></i> Route Summary</h4>
                        <p><strong>Total Pandals:</strong> ${this.selectedPandals.length}</p>
                        <p><strong>Estimated Distance:</strong> ${totalDistance.toFixed(1)} km</p>
                        <p><strong>Estimated Time:</strong> ${Math.floor(estimatedTime/60)}h ${estimatedTime%60}m</p>
                        <p><strong>Best Time to Start:</strong> Early morning (6 AM) for less crowds</p>
                    </div>
                `;
            }

            displayAdvancedRouteInfo(distanceKm, timeMinutes, route) {
                const routeInfo = document.getElementById('route-info');
                const timeHours = Math.floor(timeMinutes / 60);
                const remainingMinutes = timeMinutes % 60;
                
                // Calculate estimated time with pandal visit time
                const visitTimePerPandal = 30; // 30 minutes per pandal
                const totalVisitTime = this.selectedPandals.length * visitTimePerPandal;
                const totalTimeWithVisits = timeMinutes + totalVisitTime;
                const totalHours = Math.floor(totalTimeWithVisits / 60);
                const totalRemainingMinutes = totalTimeWithVisits % 60;
                
                // Transport mode specific info
                let transportIcon = '🚶';
                let transportName = 'Walking';
                let speedTip = 'Comfortable walking pace';
                
                if (this.transportMode === 'driving') {
                    transportIcon = '🚗';
                    transportName = 'Driving';
                    speedTip = 'Consider traffic and parking';
                } else if (this.transportMode === 'cycling') {
                    transportIcon = '🚴';
                    transportName = 'Cycling';
                    speedTip = 'Bicycle-friendly routes';
                }
                
                routeInfo.innerHTML = `
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h4><i class="fas fa-route"></i> Road-Based Route Summary (${transportIcon} ${transportName})</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                            <div><strong>📍 Total Pandals:</strong> ${this.selectedPandals.length}</div>
                            <div><strong>🛣️ ${transportName} Distance:</strong> ${distanceKm} km</div>
                            <div><strong>⏱️ ${transportName} Time:</strong> ${timeHours}h ${remainingMinutes}m</div>
                            <div><strong>🎯 Total Journey:</strong> ${totalHours}h ${totalRemainingMinutes}m</div>
                        </div>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #ffc107;">
                            <strong>💡 ${transportName} Tips:</strong><br>
                            • ${speedTip}<br>
                            • Start early morning (6-7 AM) for less crowds<br>
                            • Carry water and ${this.transportMode === 'foot' ? 'comfortable shoes' : this.transportMode === 'cycling' ? 'safety gear' : 'check parking availability'}<br>
                            • Allow extra time for photography and food
                        </div>
                        <div style="background: #d1ecf1; padding: 10px; border-radius: 5px; border-left: 4px solid #17a2b8;">
                            <strong>🚌 Alternative Transport:</strong><br>
                            • Walking: Best for nearby pandals<br>
                            • Auto/Taxi: For longer distances<br>
                            • Metro: Use for major hubs<br>
                            • Bus: Check local routes
                        </div>
                    </div>
                `;
            }

            displayRouteOptimizationInfo() {
                const routeInfo = document.getElementById('route-info');
                const currentInfo = routeInfo.innerHTML;
                
                routeInfo.innerHTML = currentInfo + `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid #dee2e6;">
                        <h5><i class="fas fa-cogs"></i> Route Optimization</h5>
                        <p style="margin: 5px 0;"><i class="fas fa-check-circle" style="color: #28a745;"></i> <strong>Shortest Path Algorithm Applied</strong></p>
                        <p style="margin: 5px 0;"><i class="fas fa-road" style="color: #007bff;"></i> <strong>Real Road Network Used</strong></p>
                        <p style="margin: 5px 0;"><i class="fas fa-walking" style="color: #fd7e14;"></i> <strong>Walking Directions Optimized</strong></p>
                        <small style="color: #6c757d;">
                            Routes are calculated using OpenStreetMap data and optimized for walking. 
                            Times include walking pace and account for traffic conditions.
                        </small>
                    </div>
                `;
            }

            toggleRoutePlanner() {
                const planner = document.getElementById('route-planner');
                const planRouteBtn = document.getElementById('plan-route-btn');
                
                if (planner.style.display === 'none') {
                    // Show route planner
                    planner.style.display = 'block';
                    this.showPandalSelection();
                    
                    // Update button text and style
                    if (planRouteBtn) {
                        planRouteBtn.innerHTML = '<i class="fas fa-times"></i> Close Route Planner';
                        planRouteBtn.className = 'btn btn-warning';
                    }
                    
                    // Scroll to route planner section
                    planner.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                } else {
                    // Hide route planner
                    planner.style.display = 'none';
                    this.resetRouteSelection();
                    
                    // Reset button text and style
                    if (planRouteBtn) {
                        planRouteBtn.innerHTML = '<i class="fas fa-route"></i> Plan Route';
                        planRouteBtn.className = 'btn btn-secondary';
                    }
                }
            }

            showPandalSelection() {
                const checklist = document.getElementById('pandal-checklist');
                checklist.innerHTML = '';

                // Add event listeners for search and filters with a slight delay to ensure DOM is ready
                setTimeout(() => {
                    this.initializeSearchAndFilters();
                    // Apply current filters and render
                    this.renderFilteredPandals();
                }, 100);
            }

            initializeSearchAndFilters() {
                const searchInput = document.getElementById('pandal-search');
                const areaFilter = document.getElementById('area-filter');
                const themeFilter = document.getElementById('theme-filter');
                const clearBtn = document.getElementById('clear-filters-btn');

                // Ensure elements exist before adding listeners
                if (searchInput && !searchInput.hasAttribute('data-listener-added')) {
                    searchInput.addEventListener('input', (e) => {
                        console.log('Search input changed:', e.target.value); // Debug
                        this.renderFilteredPandals();
                    });
                    searchInput.setAttribute('data-listener-added', 'true');
                }
                
                if (areaFilter && !areaFilter.hasAttribute('data-listener-added')) {
                    areaFilter.addEventListener('change', (e) => {
                        console.log('Area filter changed:', e.target.value); // Debug
                        this.renderFilteredPandals();
                    });
                    areaFilter.setAttribute('data-listener-added', 'true');
                }
                
                if (themeFilter && !themeFilter.hasAttribute('data-listener-added')) {
                    themeFilter.addEventListener('change', (e) => {
                        console.log('Theme filter changed:', e.target.value); // Debug
                        this.renderFilteredPandals();
                    });
                    themeFilter.setAttribute('data-listener-added', 'true');
                }

                if (clearBtn && !clearBtn.hasAttribute('data-listener-added')) {
                    clearBtn.addEventListener('click', (e) => {
                        console.log('Clear filters clicked'); // Debug
                        this.clearFilters();
                    });
                    clearBtn.setAttribute('data-listener-added', 'true');
                }
            }

            clearFilters() {
                // Reset all filter controls
                const searchInput = document.getElementById('pandal-search');
                const areaFilter = document.getElementById('area-filter');
                const themeFilter = document.getElementById('theme-filter');

                if (searchInput) searchInput.value = '';
                if (areaFilter) areaFilter.value = '';
                if (themeFilter) themeFilter.value = '';

                // Re-render with cleared filters
                this.renderFilteredPandals();
            }

            getFilteredPandals() {
                const searchTerm = document.getElementById('pandal-search')?.value.toLowerCase() || '';
                const selectedArea = document.getElementById('area-filter')?.value || '';
                const selectedTheme = document.getElementById('theme-filter')?.value || '';

                console.log('Filter values:', { searchTerm, selectedArea, selectedTheme }); // Debug log

                return this.pandals.filter(pandal => {
                    // Search filter - check name, area, description, and nearest metro
                    const matchesSearch = searchTerm === '' || 
                        pandal.name.toLowerCase().includes(searchTerm) ||
                        pandal.area.toLowerCase().includes(searchTerm) ||
                        pandal.description.toLowerCase().includes(searchTerm) ||
                        pandal.nearestMetro.toLowerCase().includes(searchTerm);

                    // Area filter - exact match for area
                    const matchesArea = selectedArea === '' || pandal.area === selectedArea;

                    // Theme filter
                    const matchesTheme = selectedTheme === '' || this.getPandalTheme(pandal).includes(selectedTheme);

                    const matches = matchesSearch && matchesArea && matchesTheme;
                    
                    // Debug log for area filtering
                    if (selectedArea && !matchesArea) {
                        console.log(`Area mismatch: ${pandal.name} - Expected: ${selectedArea}, Got: ${pandal.area}`);
                    }

                    return matches;
                });
            }

            getPandalTheme(pandal) {
                const themes = [];
                const desc = pandal.description.toLowerCase();
                const name = pandal.name.toLowerCase();

                // Simple theme classification based on keywords
                if (desc.includes('traditional') || desc.includes('heritage') || name.includes('heritage')) {
                    themes.push('Traditional', 'Heritage');
                }
                if (desc.includes('modern') || desc.includes('contemporary')) {
                    themes.push('Modern', 'Contemporary');
                }
                if (desc.includes('eco') || desc.includes('green') || desc.includes('sustainable')) {
                    themes.push('Eco-friendly');
                }
                if (desc.includes('art') || desc.includes('sculpture') || desc.includes('creative')) {
                    themes.push('Artistic');
                }
                
                // Default themes if none detected
                if (themes.length === 0) {
                    if (pandal.area === 'North' || pandal.area === 'Central') {
                        themes.push('Traditional');
                    } else {
                        themes.push('Contemporary');
                    }
                }

                return themes;
            }

            renderFilteredPandals() {
                const checklist = document.getElementById('pandal-checklist');
                const resultsDiv = document.getElementById('filter-results');
                
                if (!checklist) {
                    console.error('Pandal checklist element not found');
                    return;
                }
                
                checklist.innerHTML = '';

                const filteredPandals = this.getFilteredPandals();
                
                console.log(`Filtered pandals count: ${filteredPandals.length} out of ${this.pandals.length}`); // Debug
                
                // Update results count
                if (resultsDiv) {
                    resultsDiv.textContent = `Showing ${filteredPandals.length} of ${this.pandals.length} pandals`;
                }

                if (filteredPandals.length === 0) {
                    checklist.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">No pandals found matching your criteria</div>';
                    this.updateSelectedCount();
                    return;
                }

                // Sort pandals by area for better organization
                const sortedPandals = [...filteredPandals].sort((a, b) => {
                    if (a.area !== b.area) return a.area.localeCompare(b.area);
                    return a.name.localeCompare(b.name);
                });

                let currentArea = '';
                sortedPandals.forEach(pandal => {
                    // Add area header if new area
                    if (pandal.area !== currentArea) {
                        currentArea = pandal.area;
                        const areaHeader = document.createElement('div');
                        areaHeader.style.cssText = 'font-weight: bold; color: #d32f2f; margin: 15px 0 8px 0; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0;';
                        areaHeader.textContent = `${pandal.area} Kolkata`;
                        checklist.appendChild(areaHeader);
                    }

                    const pandalItem = document.createElement('div');
                    pandalItem.style.cssText = 'display: flex; align-items: center; padding: 8px; margin: 5px 0; background: #f9f9f9; border-radius: 5px; cursor: pointer;';
                    
                    const distance = this.userLocation ? this.calculateDistance(this.userLocation, pandal).toFixed(1) : '--';
                    const themes = this.getPandalTheme(pandal).join(', ');
                    
                    pandalItem.innerHTML = `
                        <input type="checkbox" id="pandal-${pandal.id}" style="margin-right: 10px; transform: scale(1.2);">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; color: #333;">${pandal.name}</div>
                            <div style="font-size: 12px; color: #666;">
                                📍 ${distance} km away • ⭐ ${pandal.rating} • 🚇 ${pandal.nearestMetro}
                            </div>
                            <div style="font-size: 11px; color: #999;">${pandal.description}</div>
                            <div style="font-size: 10px; color: #007bff; margin-top: 2px;">🎨 ${themes}</div>
                        </div>
                    `;

                    pandalItem.addEventListener('click', (e) => {
                        if (e.target.type !== 'checkbox') {
                            const checkbox = pandalItem.querySelector('input[type="checkbox"]');
                            checkbox.checked = !checkbox.checked;
                        }
                        this.updateSelectedCount();
                    });

                    checklist.appendChild(pandalItem);
                });

                this.updateSelectedCount();
            }

            updateSelectedCount() {
                const checkboxes = document.querySelectorAll('#pandal-checklist input[type="checkbox"]');
                const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
                const startBtn = document.getElementById('start-route-btn');
                
                if (selectedCount === 0) {
                    startBtn.innerHTML = '<i class="fas fa-play"></i> Select Pandals to Start Route';
                    startBtn.disabled = true;
                    startBtn.style.opacity = '0.6';
                } else {
                    startBtn.innerHTML = `<i class="fas fa-play"></i> Start Route to ${selectedCount} Pandal${selectedCount > 1 ? 's' : ''}`;
                    startBtn.disabled = false;
                    startBtn.style.opacity = '1';
                }
            }

            startSelectedRoute() {
                if (!this.userLocation) {
                    alert('Please enable location tracking first to start your route!');
                    return;
                }

                const checkboxes = document.querySelectorAll('#pandal-checklist input[type="checkbox"]:checked');
                const selectedPandalIds = Array.from(checkboxes).map(cb => parseInt(cb.id.replace('pandal-', '')));
                
                if (selectedPandalIds.length === 0) {
                    alert('Please select at least one pandal to visit!');
                    return;
                }

                // Get selected pandals
                const selectedPandals = this.pandals.filter(p => selectedPandalIds.includes(p.id));
                
                // Optimize route based on distance from user location
                this.activeRoute = this.optimizeRouteFromLocation(selectedPandals);
                this.currentDestinationIndex = 0;
                this.isRouteActive = true;
                
                // Initialize route tracking
                this.routeStartTime = new Date();
                this.visitedDestinations = [];
                this.destinationArrivalTimes = [];

                // Switch to active route view
                document.getElementById('pandal-selection').style.display = 'none';
                document.getElementById('active-route').style.display = 'block';

                // Start navigation
                this.startActiveNavigation();
            }

            optimizeRouteFromLocation(pandals) {
                if (!this.userLocation || pandals.length <= 1) return pandals;

                // Start with closest pandal to user location
                let optimized = [];
                let remaining = [...pandals];
                let currentPos = this.userLocation;

                while (remaining.length > 0) {
                    let nearest = remaining[0];
                    let minDistance = this.calculateDistance(currentPos, nearest);

                    remaining.forEach(pandal => {
                        const distance = this.calculateDistance(currentPos, pandal);
                        if (distance < minDistance) {
                            minDistance = distance;
                            nearest = pandal;
                        }
                    });

                    optimized.push(nearest);
                    remaining = remaining.filter(p => p.id !== nearest.id);
                    currentPos = nearest;
                }

                return optimized;
            }

            startActiveNavigation() {
                this.updateCurrentDestination();
                this.createRouteVisualization();
                this.updateRouteProgress();
            }

            updateCurrentDestination() {
                if (this.currentDestinationIndex >= this.activeRoute.length) {
                    this.completeRoute();
                    return;
                }

                const currentPandal = this.activeRoute[this.currentDestinationIndex];
                const distance = this.userLocation ? this.calculateDistance(this.userLocation, currentPandal).toFixed(2) : '--';
                const estimatedTime = this.userLocation ? Math.ceil(this.calculateDistance(this.userLocation, currentPandal) * 10) : 0;

                document.getElementById('current-destination').innerHTML = `
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <h4 style="color: #1976d2; margin: 0 0 10px 0;">
                            <i class="fas fa-bullseye"></i> Current Destination
                        </h4>
                        <div style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 8px;">
                            ${currentPandal.name}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">
                            📍 ${distance} km away (${Math.floor(estimatedTime/60)}h ${estimatedTime%60}m walk)
                        </div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">
                            🚇 Nearest Metro: ${currentPandal.nearestMetro}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 10px;">
                            👥 Crowd Level: ${currentPandal.crowdLevel}
                        </div>
                        <div style="background: #fff; padding: 8px; border-radius: 5px; font-size: 12px; color: #555;">
                            💡 ${currentPandal.description}
                        </div>
                    </div>
                `;

                // Show next pandal if available
                if (this.currentDestinationIndex < this.activeRoute.length - 1) {
                    const nextPandal = this.activeRoute[this.currentDestinationIndex + 1];
                    document.getElementById('next-pandal').innerHTML = `
                        <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; margin: 10px 0;">
                            <h5 style="color: #666; margin: 0 0 5px 0;">
                                <i class="fas fa-arrow-right"></i> Next: ${nextPandal.name}
                            </h5>
                            <div style="font-size: 12px; color: #888;">
                                ${nextPandal.area} Kolkata • ${nextPandal.theme}
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('next-pandal').innerHTML = `
                        <div style="background: #e8f5e8; padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center;">
                            <div style="color: #4caf50; font-weight: bold;">
                                🎉 This is your final destination!
                            </div>
                        </div>
                    `;
                }
            }

            updateRouteProgress() {
                const totalPandals = this.activeRoute.length;
                const completed = this.currentDestinationIndex;
                const progressPercent = (completed / totalPandals) * 100;

                document.getElementById('route-progress').innerHTML = `
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-size: 14px; font-weight: bold;">Progress</span>
                            <span style="font-size: 14px;">${completed}/${totalPandals} completed</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #4caf50, #8bc34a); height: 100%; width: ${progressPercent}%; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px; text-align: center;">
                            ${totalPandals - completed} pandal${totalPandals - completed !== 1 ? 's' : ''} remaining
                        </div>
                    </div>
                `;
            }

            createRouteVisualization() {
                // Clear existing route lines
                this.routePolylines.forEach(line => this.map.removeLayer(line));
                this.routePolylines = [];
                
                // Clear existing styled segments
                if (this.styledSegments) {
                    this.styledSegments.forEach(segment => this.map.removeLayer(segment));
                    this.styledSegments = [];
                }

                if (!this.userLocation || this.activeRoute.length === 0) return;

                // Create road-based route segments for active navigation
                this.createNavigationRouteSegments();
            }
            
            createNavigationRouteSegments() {
                // Create complete route showing all destinations with different styling
                if (!this.userLocation || this.activeRoute.length === 0) return;
                
                // Create full route waypoints starting from user location
                const allWaypoints = [L.latLng(this.userLocation.lat, this.userLocation.lng)];
                
                // Add all pandal locations to waypoints
                this.activeRoute.forEach(pandal => {
                    allWaypoints.push(L.latLng(pandal.lat, pandal.lng));
                });
                
                // Create complete route control
                const fullRouteControl = L.Routing.control({
                    waypoints: allWaypoints,
                    routeWhileDragging: false,
                    addWaypoints: false,
                    draggableWaypoints: false,
                    show: false,
                    createMarker: function() { return null; }, // Don't create default markers
                    router: L.Routing.osrmv1({
                        serviceUrl: 'https://router.project-osrm.org/route/v1',
                        profile: window.app.transportMode
                    }),
                    lineOptions: {
                        styles: [
                            {color: '#ff6b6b', opacity: 0.7, weight: 8}, // Main route line
                            {color: 'white', opacity: 0.9, weight: 4}   // White outline
                        ]
                    }
                });
                
                fullRouteControl.on('routesfound', (e) => {
                    const route = e.routes[0];
                    
                    // Create segment-specific styling
                    this.createStyledRouteSegments(route, allWaypoints);
                    
                    // Update navigation info for current destination
                    if (this.currentDestinationIndex < this.activeRoute.length) {
                        const currentDestination = this.activeRoute[this.currentDestinationIndex];
                        this.updateCurrentDestinationInfo(route, currentDestination);
                    }
                });
                
                fullRouteControl.addTo(this.map);
                this.routePolylines.push(fullRouteControl);

                // Add enhanced markers for all pandals in the route
                this.addEnhancedRouteMarkers();
                
                // Focus map to show the full route
                this.focusMapOnFullRoute();
            }
            
            createStyledRouteSegments(route, waypoints) {
                // Remove any existing styled segments
                if (this.styledSegments) {
                    this.styledSegments.forEach(segment => this.map.removeLayer(segment));
                }
                this.styledSegments = [];
                
                // Create styled segments for different parts of the route
                const coordinates = route.coordinates;
                if (!coordinates || coordinates.length < 2) return;
                
                // Find approximate segment boundaries based on waypoints
                const segmentBoundaries = this.findSegmentBoundaries(coordinates, waypoints);
                
                // Create styled polylines for each segment
                for (let i = 0; i < segmentBoundaries.length - 1; i++) {
                    const startIdx = segmentBoundaries[i];
                    const endIdx = segmentBoundaries[i + 1];
                    const segmentCoords = coordinates.slice(startIdx, endIdx + 1);
                    
                    // Convert coordinates to Leaflet LatLng format
                    const latLngs = segmentCoords.map(coord => L.latLng(coord.lat, coord.lng));
                    
                    // Determine segment styling based on progress
                    let segmentStyle;
                    if (i < this.currentDestinationIndex) {
                        // Completed segments - green
                        segmentStyle = {
                            color: '#4caf50',
                            weight: 6,
                            opacity: 0.9,
                            dashArray: ''
                        };
                    } else if (i === this.currentDestinationIndex) {
                        // Current segment - blue with animation
                        segmentStyle = {
                            color: '#2196f3',
                            weight: 8,
                            opacity: 0.9,
                            dashArray: '10, 5',
                            className: 'current-route-segment'
                        };
                    } else {
                        // Future segments - orange dashed
                        segmentStyle = {
                            color: '#ff9800',
                            weight: 4,
                            opacity: 0.6,
                            dashArray: '15, 10'
                        };
                    }
                    
                    const segmentPolyline = L.polyline(latLngs, segmentStyle);
                    
                    // Add popup with segment info
                    const destinationName = i < this.activeRoute.length ? this.activeRoute[i].name : 'Final Destination';
                    segmentPolyline.bindPopup(`
                        <div style="text-align: center;">
                            <strong>Segment ${i + 1}</strong><br>
                            To: ${destinationName}<br>
                            Status: ${i < this.currentDestinationIndex ? '✅ Completed' : i === this.currentDestinationIndex ? '📍 Current' : '⏳ Upcoming'}
                        </div>
                    `);
                    
                    segmentPolyline.addTo(this.map);
                    this.styledSegments.push(segmentPolyline);
                }
            }
            
            findSegmentBoundaries(coordinates, waypoints) {
                const boundaries = [0]; // Start with first coordinate
                
                // For each waypoint (except first), find closest coordinate
                for (let i = 1; i < waypoints.length; i++) {
                    const waypoint = waypoints[i];
                    let closestIdx = 0;
                    let minDistance = Infinity;
                    
                    for (let j = boundaries[boundaries.length - 1]; j < coordinates.length; j++) {
                        const coord = coordinates[j];
                        const distance = Math.sqrt(
                            Math.pow(coord.lat - waypoint.lat, 2) + 
                            Math.pow(coord.lng - waypoint.lng, 2)
                        );
                        
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestIdx = j;
                        }
                    }
                    
                    boundaries.push(closestIdx);
                }
                
                // Add final coordinate
                if (boundaries[boundaries.length - 1] !== coordinates.length - 1) {
                    boundaries.push(coordinates.length - 1);
                }
                
                return boundaries;
            }
            
            updateCurrentDestinationInfo(route, currentDestination) {
                // Find current segment distance and time
                const segmentDistance = this.calculateSegmentDistance(route, this.currentDestinationIndex);
                const segmentTime = this.calculateSegmentTime(route, this.currentDestinationIndex);
                
                // Get turn-by-turn instructions for current segment
                const instructions = route.instructions || [];
                const currentInstructions = this.getCurrentSegmentInstructions(instructions, this.currentDestinationIndex);
                
                this.updateNavigationInfo(currentDestination, segmentDistance, segmentTime, currentInstructions);
            }
            
            calculateSegmentDistance(route, segmentIndex) {
                // Approximate segment distance (in practice, you'd need more precise calculation)
                const totalDistance = route.summary.totalDistance / 1000; // Convert to km
                const estimatedSegmentDistance = (totalDistance / this.activeRoute.length).toFixed(1);
                return estimatedSegmentDistance;
            }
            
            calculateSegmentTime(route, segmentIndex) {
                // Approximate segment time (in practice, you'd need more precise calculation)
                const totalTime = route.summary.totalTime / 60; // Convert to minutes
                const estimatedSegmentTime = Math.round(totalTime / this.activeRoute.length);
                return estimatedSegmentTime;
            }
            
            getCurrentSegmentInstructions(instructions, segmentIndex) {
                // Return relevant instructions for current segment
                const instructionsPerSegment = Math.ceil(instructions.length / this.activeRoute.length);
                const startIdx = segmentIndex * instructionsPerSegment;
                const endIdx = Math.min(startIdx + instructionsPerSegment, instructions.length);
                
                return instructions.slice(startIdx, endIdx);
            }
            
            focusMapOnFullRoute() {
                // Fit map to show entire route
                if (this.activeRoute.length > 0) {
                    const bounds = L.latLngBounds([
                        [this.userLocation.lat, this.userLocation.lng]
                    ]);
                    
                    this.activeRoute.forEach(pandal => {
                        bounds.extend([pandal.lat, pandal.lng]);
                    });
                    
                    this.map.fitBounds(bounds, { padding: [20, 20] });
                }
            }

            showFullRoute() {
                // Show complete route overview with different zoom level
                this.focusMapOnFullRoute();
                
                // Show route summary popup
                const totalPandals = this.activeRoute.length;
                const completed = this.currentDestinationIndex;
                const remaining = totalPandals - completed;
                
                const routeSummary = `
                    <div style="text-align: center; padding: 15px;">
                        <h4><i class="fas fa-route"></i> Complete Route Overview</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 15px 0;">
                            <div style="background: #4caf50; color: white; padding: 10px; border-radius: 8px;">
                                <strong>${completed}</strong><br>
                                <small>Completed</small>
                            </div>
                            <div style="background: ${completed < totalPandals ? '#2196f3' : '#e0e0e0'}; color: white; padding: 10px; border-radius: 8px;">
                                <strong>${completed < totalPandals ? '1' : '0'}</strong><br>
                                <small>Current</small>
                            </div>
                            <div style="background: #ff9800; color: white; padding: 10px; border-radius: 8px;">
                                <strong>${remaining - (completed < totalPandals ? 1 : 0)}</strong><br>
                                <small>Remaining</small>
                            </div>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-top: 10px;">
                            <strong>Legend:</strong><br>
                            <span style="color: #4caf50;">🟢 Completed Routes</span><br>
                            <span style="color: #2196f3;">🔵 Current Route</span><br>
                            <span style="color: #ff9800;">🟠 Upcoming Routes</span>
                        </div>
                    </div>
                `;
                
                // Create temporary popup for route overview
                const center = this.map.getCenter();
                const popup = L.popup()
                    .setLatLng(center)
                    .setContent(routeSummary)
                    .openOn(this.map);
                
                // Auto-close popup after 5 seconds
                setTimeout(() => {
                    if (popup.isOpen()) {
                        this.map.closePopup(popup);
                    }
                }, 5000);
                
                console.log('Showing full route overview');
            }
            
            addEnhancedRouteMarkers() {
                this.activeRoute.forEach((pandal, index) => {
                    const isCompleted = index < this.currentDestinationIndex;
                    const isCurrent = index === this.currentDestinationIndex;
                    
                    let markerColor = '#ff9800'; // Upcoming
                    let markerIcon = '⏳';
                    let statusText = 'Upcoming';
                    
                    if (isCompleted) {
                        markerColor = '#4caf50';
                        markerIcon = '✅';
                        statusText = 'Completed';
                    } else if (isCurrent) {
                        markerColor = '#2196f3';
                        markerIcon = '📍';
                        statusText = 'Current Destination';
                    }

                    const numberIcon = L.divIcon({
                        html: `<div style="background: ${markerColor}; color: white; border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white; box-shadow: 0 3px 8px rgba(0,0,0,0.3); position: relative;">
                                ${index + 1}
                                <div style="position: absolute; top: -8px; right: -8px; font-size: 12px;">${markerIcon}</div>
                              </div>`,
                        iconSize: [35, 35],
                        className: 'enhanced-route-icon'
                    });

                    const marker = L.marker([pandal.lat, pandal.lng], { icon: numberIcon })
                        .addTo(this.map)
                        .bindPopup(`
                            <div style="text-align: center;">
                                <h4>${index + 1}. ${pandal.name}</h4>
                                <div style="background: ${markerColor}; color: white; padding: 5px; border-radius: 15px; margin: 5px 0; font-size: 12px;">
                                    ${statusText}
                                </div>
                                <p><strong>Area:</strong> ${pandal.area}</p>
                                <p><strong>Theme:</strong> ${pandal.theme}</p>
                                <p><strong>Rating:</strong> ⭐ ${pandal.rating}/5</p>
                                ${isCurrent ? '<button onclick="window.app.arrivedAtPandal()" style="background: #2196f3; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-top: 10px;">Mark as Visited</button>' : ''}
                            </div>
                        `);
                        
                    this.routePolylines.push(marker);
                });
            }
            
            updateNavigationInfo(destination, distance, time, instructions) {
                const currentDestInfo = document.getElementById('current-destination');
                if (currentDestInfo) {
                    const directionSteps = instructions.slice(0, 3).map((step, index) => 
                        `<div style="margin: 5px 0; padding: 8px; background: #f8f9fa; border-radius: 5px; border-left: 3px solid #2196f3;">
                            <strong>Step ${index + 1}:</strong> ${step.text || step.instruction}
                            ${step.distance ? `<span style="float: right; color: #666;">${Math.round(step.distance)}m</span>` : ''}
                        </div>`
                    ).join('');
                    
                    currentDestInfo.innerHTML = `
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <h4><i class="fas fa-navigation" style="color: #2196f3;"></i> ${destination.name}</h4>
                            
                            <!-- Proximity Indicator -->
                            <div id="proximity-indicator" style="background: rgba(33, 150, 243, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center; font-weight: bold; color: #666;">
                                📍 Calculating distance...
                            </div>
                            
                            <!-- Auto Arrival Settings -->
                            <div style="background: rgba(76, 175, 80, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="auto-arrival-toggle" ${this.autoArrivalEnabled ? 'checked' : ''} 
                                           onchange="window.app.toggleAutoArrival(this.checked)" style="margin: 0;">
                                    <span style="font-size: 0.9em;">🤖 Auto-detect arrival (40m radius)</span>
                                </label>
                                <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                                    When enabled, automatically marks destination as visited when you're nearby
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                                <div><strong>🚶 Distance:</strong> ${distance} km</div>
                                <div><strong>⏱️ Walking Time:</strong> ${time} min</div>
                                <div><strong>📍 Area:</strong> ${destination.area}</div>
                                <div><strong>⭐ Rating:</strong> ${destination.rating}/5</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <h5><i class="fas fa-directions"></i> Turn-by-Turn Directions:</h5>
                                ${directionSteps}
                                ${instructions.length > 3 ? `<small style="color: #666;">... and ${instructions.length - 3} more steps</small>` : ''}
                            </div>
                            <button onclick="window.app.arrivedAtPandal()" style="background: #4caf50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px; width: 100%;">
                                <i class="fas fa-check"></i> Mark as Visited & Continue
                            </button>
                        </div>
                    `;
                }
            }

            arrivedAtPandal(isAutomatic = false) {
                if (this.currentDestinationIndex < this.activeRoute.length) {
                    const currentDestination = this.activeRoute[this.currentDestinationIndex];
                    const arrivalTime = new Date();
                    
                    // Record the visit
                    this.visitedDestinations.push({
                        pandal: currentDestination,
                        arrivalTime: arrivalTime,
                        destinationNumber: this.currentDestinationIndex + 1,
                        isAutomatic: isAutomatic,
                        timeSpent: this.calculateTimeSpent()
                    });
                    
                    // Show progress update
                    this.updateProgressDisplay();
                    
                    // Move to next destination
                    this.currentDestinationIndex++;
                    
                    if (this.currentDestinationIndex >= this.activeRoute.length) {
                        this.completeRoute();
                    } else {
                        this.updateCurrentDestination();
                        this.createRouteVisualization();
                        this.updateRouteProgress();
                        
                        // Show next destination notification
                        this.showNextDestinationNotification();
                    }
                }
            }

            calculateTimeSpent() {
                if (this.routeStartTime && this.destinationArrivalTimes.length > 0) {
                    const lastTime = this.destinationArrivalTimes.length > 1 ? 
                        this.destinationArrivalTimes[this.destinationArrivalTimes.length - 2].arrivalTime : 
                        this.routeStartTime;
                    return new Date() - new Date(lastTime);
                }
                return 0;
            }

            updateProgressDisplay() {
                const completed = this.currentDestinationIndex + 1;
                const total = this.activeRoute.length;
                const percentage = Math.round((completed / total) * 100);
                
                // Show/hide undo button
                const undoBtn = document.getElementById('undo-arrival-btn');
                if (undoBtn) {
                    undoBtn.style.display = this.visitedDestinations.length > 0 ? 'block' : 'none';
                }
                
                // Update progress text with ordinal numbers
                const progressElement = document.getElementById('route-progress');
                if (progressElement) {
                    let progressHTML = `
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <h4 style="color: #4caf50; margin: 0 0 10px 0;">
                                🎯 Progress: ${completed}/${total} Destinations (${percentage}%)
                            </h4>
                            <div class="progress-bar" style="background: #ddd; border-radius: 10px; height: 20px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #4caf50, #45a049); width: ${percentage}%; height: 100%; transition: width 0.5s ease;"></div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9em;">
                    `;
                    
                    // Add completed destinations list
                    this.visitedDestinations.forEach((visit, index) => {
                        const ordinal = this.getOrdinalNumber(visit.destinationNumber);
                        const autoIcon = visit.isAutomatic ? '🤖' : '👤';
                        progressHTML += `
                            <div style="color: #4caf50; margin: 3px 0;">
                                ✅ ${ordinal} - ${visit.pandal.name} ${autoIcon}
                                <small style="opacity: 0.7;">(${visit.arrivalTime.toLocaleTimeString()})</small>
                            </div>
                        `;
                    });
                    
                    progressHTML += '</div></div>';
                    progressElement.innerHTML = progressHTML;
                }
            }

            getOrdinalNumber(num) {
                const suffixes = ['th', 'st', 'nd', 'rd'];
                const mod100 = num % 100;
                return num + (suffixes[(mod100 - 20) % 10] || suffixes[mod100] || suffixes[0]);
            }

            showNextDestinationNotification() {
                if (this.currentDestinationIndex < this.activeRoute.length) {
                    const nextDestination = this.activeRoute[this.currentDestinationIndex];
                    const nextNumber = this.currentDestinationIndex + 1;
                    const ordinal = this.getOrdinalNumber(nextNumber);
                    
                    const notification = document.createElement('div');
                    notification.className = 'arrival-notification';
                    notification.style.background = 'linear-gradient(135deg, #2196f3, #1976d2)';
                    notification.innerHTML = `
                        <div class="notification-content">
                            <div class="notification-icon">🎯</div>
                            <div class="notification-text">
                                <h3>Next: ${ordinal} Destination</h3>
                                <p>${nextDestination.name}</p>
                                <small>Navigate to continue your route</small>
                            </div>
                            <button onclick="this.parentElement.parentElement.remove()" class="notification-close">×</button>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // Auto-remove after 4 seconds
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 4000);
                }
            }

            completeRoute() {
                this.isRouteActive = false;
                
                document.getElementById('current-destination').innerHTML = `
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 10px 0; text-align: center;">
                        <h3 style="color: #4caf50; margin: 0 0 10px 0;">
                            🎉 Route Completed!
                        </h3>
                        <p style="margin: 0; color: #666;">
                            Congratulations! You've visited all ${this.activeRoute.length} pandals on your route.
                        </p>
                        <button onclick="window.app.resetRoute()" style="background: #4caf50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
                            Plan New Route
                        </button>
                    </div>
                `;
                
                document.getElementById('next-pandal').innerHTML = '';
                document.getElementById('route-progress').innerHTML = '';
                
                // Hide arrived button
                document.getElementById('arrived-btn').style.display = 'none';
            }

            resetRoute() {
                this.isRouteActive = false;
                this.activeRoute = [];
                this.currentDestinationIndex = 0;
                
                // Reset navigation tracking
                this.visitedDestinations = [];
                this.destinationArrivalTimes = [];
                this.routeStartTime = null;
                this.lastNotificationTime = 0;
                
                // Clear route visualization
                this.routePolylines.forEach(line => this.map.removeLayer(line));
                this.routePolylines = [];
                
                // Reset UI
                document.getElementById('pandal-selection').style.display = 'block';
                document.getElementById('active-route').style.display = 'none';
                document.getElementById('arrived-btn').style.display = 'block';
                
                // Clear all checkboxes
                const checkboxes = document.querySelectorAll('#pandal-checklist input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);
                this.updateSelectedCount();
            }

            toggleAutoArrival(enabled) {
                this.autoArrivalEnabled = enabled;
                const statusText = enabled ? 'enabled' : 'disabled';
                
                // Show brief notification
                const notification = document.createElement('div');
                notification.className = 'arrival-notification';
                notification.style.background = enabled ? 
                    'linear-gradient(135deg, #4caf50, #45a049)' : 
                    'linear-gradient(135deg, #ff9800, #f57c00)';
                notification.innerHTML = `
                    <div class="notification-content">
                        <div class="notification-icon">${enabled ? '🤖' : '👤'}</div>
                        <div class="notification-text">
                            <h3>Auto-arrival ${statusText}</h3>
                            <p>${enabled ? 'Will auto-detect when you arrive' : 'Manual marking required'}</p>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="notification-close">×</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Auto-remove after 3 seconds
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 3000);
            }

            undoLastArrival() {
                if (this.visitedDestinations.length > 0 && this.currentDestinationIndex > 0) {
                    // Remove last visit
                    const lastVisit = this.visitedDestinations.pop();
                    this.destinationArrivalTimes.pop();
                    
                    // Go back to previous destination
                    this.currentDestinationIndex--;
                    
                    // Update displays
                    this.updateCurrentDestination();
                    this.updateProgressDisplay();
                    this.createRouteVisualization();
                    
                    // Show undo notification
                    const notification = document.createElement('div');
                    notification.className = 'arrival-notification';
                    notification.style.background = 'linear-gradient(135deg, #ff9800, #f57c00)';
                    notification.innerHTML = `
                        <div class="notification-content">
                            <div class="notification-icon">↩️</div>
                            <div class="notification-text">
                                <h3>Undone: ${lastVisit.pandal.name}</h3>
                                <p>Returned to previous destination</p>
                            </div>
                            <button onclick="this.parentElement.parentElement.remove()" class="notification-close">×</button>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 4000);
                }
            }

            resetRouteSelection() {
                this.resetRoute();
            }

            bindEvents() {
                // Add debugging to check if elements exist
                console.log('Binding events...');

                // Search functionality
                const searchBtn = document.getElementById('search-btn');
                const searchInput = document.getElementById('search-input');
                
                if (searchBtn) {
                    searchBtn.addEventListener('click', () => {
                        this.filterPandals();
                    });
                }

                if (searchInput) {
                    searchInput.addEventListener('keyup', (e) => {
                        if (e.key === 'Enter') {
                            this.filterPandals();
                        }
                    });
                }

                // Filter functionality
                const areaFilter = document.getElementById('area-filter');
                const themeFilter = document.getElementById('theme-filter');
                
                if (areaFilter) {
                    areaFilter.addEventListener('change', () => {
                        this.filterPandals();
                    });
                }

                if (themeFilter) {
                    themeFilter.addEventListener('change', () => {
                        this.filterPandals();
                    });
                }

                // Button events
                const showAllBtn = document.getElementById('show-all-btn');
                if (showAllBtn) {
                    showAllBtn.addEventListener('click', () => {
                        this.showAllPandals();
                    });
                }

                const planRouteBtn = document.getElementById('plan-route-btn');
                if (planRouteBtn) {
                    planRouteBtn.addEventListener('click', () => {
                        this.toggleRoutePlanner();
                    });
                }

                // Route planner buttons (these might not exist initially)
                const startRouteBtn = document.getElementById('start-route-btn');
                if (startRouteBtn) {
                    startRouteBtn.addEventListener('click', () => {
                        this.startSelectedRoute();
                    });
                }

                const arrivedBtn = document.getElementById('arrived-btn');
                if (arrivedBtn) {
                    arrivedBtn.addEventListener('click', () => {
                        this.arrivedAtPandal();
                    });
                }

                const endRouteBtn = document.getElementById('end-route-btn');
                if (endRouteBtn) {
                    endRouteBtn.addEventListener('click', () => {
                        this.resetRoute();
                    });
                }

                const optimizeRouteBtn = document.getElementById('optimize-route-btn');
                if (optimizeRouteBtn) {
                    optimizeRouteBtn.addEventListener('click', () => {
                        this.optimizeRoute();
                    });
                }

                // Modal events
                const modal = document.getElementById('info-modal');
                const toggleBtn = document.getElementById('toggle-info-btn');
                const closeBtn = document.querySelector('.close');

                if (toggleBtn && modal) {
                    toggleBtn.addEventListener('click', () => {
                        modal.style.display = 'block';
                    });
                }

                if (closeBtn && modal) {
                    closeBtn.addEventListener('click', () => {
                        modal.style.display = 'none';
                    });
                }

                if (modal) {
                    window.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                }

                // Location tracking button - This is the main issue
                const locationBtn = document.getElementById('location-btn');
                if (locationBtn) {
                    console.log('Location button found, adding event listener');
                    locationBtn.addEventListener('click', () => {
                        console.log('Location button clicked!');
                        this.toggleLocationTracking();
                    });
                } else {
                    console.error('Location button not found!');
                }

                // Change location button
                const changeLocationBtn = document.getElementById('change-location-btn');
                if (changeLocationBtn) {
                    changeLocationBtn.addEventListener('click', () => {
                        document.getElementById('location-selector-overlay').style.display = 'flex';
                    });
                }
            }

            // Location tracking methods
            toggleLocationTracking() {
                console.log('toggleLocationTracking called, current state:', this.isTrackingLocation);
                if (this.isTrackingLocation) {
                    this.stopLocationTracking();
                } else {
                    this.startLocationTracking();
                }
            }

            startLocationTracking() {
                console.log('Starting location tracking...');
                
                // Check for HTTPS requirement on mobile
                if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    if (isMobile) {
                        alert('Location access requires HTTPS on mobile devices.\n\nPlease:\n1. Use a local web server with HTTPS\n2. Or access the page through a secure hosting service');
                        return;
                    }
                }
                
                if (!navigator.geolocation) {
                    alert('Geolocation is not supported by this browser.');
                    return;
                }

                const locationBtn = document.getElementById('location-btn');
                if (!locationBtn) {
                    console.error('Location button not found!');
                    return;
                }
                
                locationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Getting Location...';
                locationBtn.disabled = true;

                // Enhanced geolocation options for mobile
                const geoOptions = {
                    enableHighAccuracy: true,
                    timeout: 20000, // Increased timeout for mobile
                    maximumAge: 30000 // Reduced max age for fresher position
                };

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log('Position received:', position);
                        this.userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            heading: position.coords.heading || null,
                            accuracy: position.coords.accuracy
                        };
                        
                        this.addUserLocationMarker();
                        this.startWatchingPosition();
                        
                        locationBtn.innerHTML = '<i class="fas fa-map-marker-alt"></i> Stop Tracking';
                        locationBtn.disabled = false;
                        locationBtn.className = 'btn btn-warning';
                        locationBtn.title = 'Location tracking active';
                        this.isTrackingLocation = true;

                        // Center map on user location
                        this.map.setView([this.userLocation.lat, this.userLocation.lng], 15);
                        
                        // Update button status after a short delay to allow compass to initialize
                        setTimeout(() => {
                            this.updateLocationButtonStatus();
                        }, 1000);
                        
                        console.log('Location tracking started successfully');
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        this.handleLocationError(error);
                        locationBtn.innerHTML = '<i class="fas fa-map-marker-alt"></i> Track My Location';
                        locationBtn.disabled = false;
                    },
                    geoOptions
                );
            }

            stopLocationTracking() {
                console.log('Stopping location tracking...');
                
                if (this.watchId) {
                    navigator.geolocation.clearWatch(this.watchId);
                    this.watchId = null;
                }

                // Stop compass tracking
                this.stopCompassTracking();

                if (this.userLocationMarker) {
                    this.map.removeLayer(this.userLocationMarker);
                    this.userLocationMarker = null;
                }

                const locationBtn = document.getElementById('location-btn');
                
                if (locationBtn) {
                    locationBtn.innerHTML = '<i class="fas fa-map-marker-alt"></i> Track My Location';
                    locationBtn.className = 'btn btn-success';
                }
                
                this.isTrackingLocation = false;
                this.userLocation = null;
                this.compassHeading = null;
                
                console.log('Location tracking stopped');
            }

            stopCompassTracking() {
                // Remove event listeners for device orientation
                if (this.orientationAbsoluteHandler) {
                    window.removeEventListener('deviceorientationabsolute', this.orientationAbsoluteHandler, true);
                }
                if (this.orientationHandler) {
                    window.removeEventListener('deviceorientation', this.orientationHandler, true);
                }
                this.orientationAbsoluteHandler = null;
                this.orientationHandler = null;
            }

            startWatchingPosition() {
                // Enhanced options for mobile devices
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                const watchOptions = {
                    enableHighAccuracy: true,
                    timeout: isMobile ? 25000 : 15000, // Longer timeout for mobile
                    maximumAge: isMobile ? 15000 : 10000 // Fresher position for mobile
                };
                
                this.watchId = navigator.geolocation.watchPosition(
                    (position) => {
                        this.userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            heading: position.coords.heading || null,
                            accuracy: position.coords.accuracy
                        };
                        this.updateUserLocationMarker();
                        
                        // Update active route if running
                        if (this.isRouteActive && this.currentDestinationIndex < this.activeRoute.length) {
                            this.updateCurrentDestination();
                            this.createRouteVisualization();
                            this.checkArrivalProximity();
                        }
                    },
                    (error) => {
                        console.warn('Location tracking error:', error);
                        // Don't show error alerts for watch position - just log it
                        if (error.code === error.TIMEOUT) {
                            console.log('Position watch timeout - continuing with last known position');
                        }
                    },
                    watchOptions
                );
                
                // Start listening for device orientation if available
                this.startCompassTracking();
            }

            startCompassTracking() {
                // Initialize compass heading
                this.compassHeading = null;
                
                // Enhanced mobile detection
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                
                console.log('Starting compass tracking - Mobile:', isMobile, 'iOS:', isIOS);
                
                // Request permission for iOS 13+ devices
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    console.log('Requesting device orientation permission...');
                    DeviceOrientationEvent.requestPermission()
                        .then(response => {
                            console.log('Device orientation permission response:', response);
                            if (response === 'granted') {
                                this.addOrientationListener();
                            } else {
                                console.log('Device orientation permission denied');
                                // For mobile without orientation, still show location without direction
                                if (isMobile) {
                                    console.log('Using location without compass on mobile');
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Device orientation permission error:', error);
                            // Fallback: try to add listener anyway for older devices
                            this.addOrientationListener();
                        });
                } else {
                    // For other devices, directly add listener
                    console.log('Adding orientation listener without permission request');
                    this.addOrientationListener();
                }
            }

            addOrientationListener() {
                // Create bound handler functions for proper removal
                this.orientationAbsoluteHandler = (event) => {
                    this.compassHeading = event.alpha; // Alpha is the compass heading
                    this.updateUserLocationMarker();
                    this.updateLocationButtonStatus();
                };

                this.orientationHandler = (event) => {
                    if (!this.compassHeading) {
                        // Convert relative orientation to absolute if possible
                        let heading = event.alpha;
                        if (event.webkitCompassHeading) {
                            heading = event.webkitCompassHeading; // iOS webkit
                        }
                        this.compassHeading = heading;
                        this.updateUserLocationMarker();
                        this.updateLocationButtonStatus();
                    }
                };

                window.addEventListener('deviceorientationabsolute', this.orientationAbsoluteHandler, true);
                // Fallback for devices that don't support deviceorientationabsolute
                window.addEventListener('deviceorientation', this.orientationHandler, true);
            }

            updateLocationButtonStatus() {
                const locationBtn = document.getElementById('location-btn');
                if (locationBtn && this.isTrackingLocation) {
                    const hasCompass = this.compassHeading !== null && !isNaN(this.compassHeading);
                    if (hasCompass) {
                        locationBtn.innerHTML = '<i class="fas fa-compass"></i> Stop Tracking (Compass)';
                        locationBtn.title = 'Location tracking with compass direction active';
                    } else {
                        locationBtn.innerHTML = '<i class="fas fa-map-marker-alt"></i> Stop Tracking';
                        locationBtn.title = 'Location tracking active (no compass data)';
                    }
                }
            }

            checkArrivalProximity() {
                if (!this.isRouteActive || this.currentDestinationIndex >= this.activeRoute.length) return;
                
                const currentDestination = this.activeRoute[this.currentDestinationIndex];
                const distance = this.calculateDistance(this.userLocation, currentDestination);
                const currentTime = Date.now();
                
                // Check if we're within arrival detection radius
                if (distance < this.arrivalDetectionRadius && this.autoArrivalEnabled) {
                    // Prevent duplicate notifications within 30 seconds
                    if (currentTime - this.lastNotificationTime > 30000) {
                        this.automaticArrivalDetected(currentDestination, distance);
                        this.lastNotificationTime = currentTime;
                    }
                } else if (distance < 0.05) {
                    // Very close proximity (50m) - highlight arrived button
                    const arrivedBtn = document.getElementById('arrived-btn');
                    if (arrivedBtn) {
                        arrivedBtn.style.background = '#4caf50';
                        arrivedBtn.style.animation = 'pulse 1s infinite';
                        arrivedBtn.innerHTML = '<i class="fas fa-check-circle"></i> You\'re here! Mark as Visited';
                    }
                } else {
                    // Reset arrived button to normal state
                    const arrivedBtn = document.getElementById('arrived-btn');
                    if (arrivedBtn) {
                        arrivedBtn.style.background = '#2196f3';
                        arrivedBtn.style.animation = 'none';
                        arrivedBtn.innerHTML = '<i class="fas fa-check"></i> I\'ve Arrived at This Pandal';
                    }
                }
                
                // Update proximity indicator
                this.updateProximityIndicator(distance);
            }

            automaticArrivalDetected(destination, distance) {
                const arrivalTime = new Date();
                const destinationNumber = this.currentDestinationIndex + 1;
                
                // Record the arrival
                this.destinationArrivalTimes.push({
                    pandal: destination,
                    arrivalTime: arrivalTime,
                    distance: distance,
                    index: this.currentDestinationIndex
                });
                
                // Show arrival notification
                this.showArrivalNotification(destination, destinationNumber);
                
                // Play arrival sound
                this.playArrivalSound();
                
                // Vibrate if supported
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                // Automatically advance to next destination after 3 seconds
                setTimeout(() => {
                    this.arrivedAtPandal(true); // true indicates automatic arrival
                }, 3000);
            }

            showArrivalNotification(destination, destinationNumber) {
                // Create notification popup
                const notification = document.createElement('div');
                notification.className = 'arrival-notification';
                notification.innerHTML = `
                    <div class="notification-content">
                        <div class="notification-icon">🎉</div>
                        <div class="notification-text">
                            <h3>Destination ${destinationNumber} Reached!</h3>
                            <p>${destination.name}</p>
                            <small>Auto-advancing in 3 seconds...</small>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="notification-close">×</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Auto-remove notification after 5 seconds
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 5000);
            }

            updateProximityIndicator(distance) {
                const distanceMeters = Math.round(distance * 1000);
                let proximityText = '';
                let proximityColor = '#666';
                
                if (distance < 0.02) { // Less than 20m
                    proximityText = `🎯 Very Close (${distanceMeters}m)`;
                    proximityColor = '#4caf50';
                } else if (distance < 0.05) { // Less than 50m
                    proximityText = `📍 Close (${distanceMeters}m)`;
                    proximityColor = '#ff9800';
                } else if (distance < 0.1) { // Less than 100m
                    proximityText = `🚶 Approaching (${distanceMeters}m)`;
                    proximityColor = '#2196f3';
                } else {
                    proximityText = `📍 ${distanceMeters}m away`;
                    proximityColor = '#666';
                }
                
                // Update proximity display
                const proximityElement = document.getElementById('proximity-indicator');
                if (proximityElement) {
                    proximityElement.innerHTML = proximityText;
                    proximityElement.style.color = proximityColor;
                }
            }

            playArrivalSound() {
                try {
                    // Create a simple audio context for arrival sound
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5 note
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5 note
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5 note
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (error) {
                    console.log('Audio not supported or permission denied');
                }
            }

            addUserLocationMarker() {
                const userIcon = this.createDirectionalUserIcon();

                this.userLocationMarker = L.marker([this.userLocation.lat, this.userLocation.lng], { 
                    icon: userIcon,
                    zIndexOffset: 1000
                })
                .addTo(this.map)
                .bindPopup(`
                    <div class="custom-popup">
                        <h3><i class="fas fa-map-marker-alt"></i> Your Location</h3>
                        <p>Lat: ${this.userLocation.lat.toFixed(6)}</p>
                        <p>Lng: ${this.userLocation.lng.toFixed(6)}</p>
                        <p>Accuracy: ±${this.userLocation.accuracy ? Math.round(this.userLocation.accuracy) : 'Unknown'} meters</p>
                        ${this.compassHeading !== null ? `<p>Heading: ${Math.round(this.compassHeading)}°</p>` : ''}
                        <button onclick="window.app.findNearestPandals()" style="background: #4caf50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 5px;">
                            Find Nearest Pandals
                        </button>
                    </div>
                `);
            }

            createDirectionalUserIcon() {
                const hasHeading = this.compassHeading !== null && !isNaN(this.compassHeading);
                const rotation = hasHeading ? this.compassHeading : 0;
                
                return L.divIcon({
                    html: `
                        <div class="user-location-container">
                            <!-- Accuracy circle -->
                            <div class="accuracy-circle" style="
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                width: 40px;
                                height: 40px;
                                border: 2px solid #4285f4;
                                border-radius: 50%;
                                background: rgba(66, 133, 244, 0.1);
                                animation: pulse-location 2s infinite;
                            "></div>
                            
                            <!-- Main location dot -->
                            <div class="location-dot" style="
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                background: #4285f4; 
                                border: 3px solid white; 
                                border-radius: 50%; 
                                width: 16px; 
                                height: 16px;
                                box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                                z-index: 2;
                            "></div>
                            
                            <!-- Directional arrow (only shown if heading is available) -->
                            ${hasHeading ? `
                            <div class="direction-arrow" style="
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%) rotate(${rotation}deg);
                                width: 0;
                                height: 0;
                                border-left: 6px solid transparent;
                                border-right: 6px solid transparent;
                                border-bottom: 20px solid #1a73e8;
                                transform-origin: center 16px;
                                z-index: 3;
                                filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
                            "></div>
                            ` : ''}
                        </div>
                        
                        <style>
                            .user-location-container {
                                position: relative;
                                width: 40px;
                                height: 40px;
                            }
                            
                            @keyframes pulse-location {
                                0% { 
                                    transform: translate(-50%, -50%) scale(1); 
                                    opacity: 0.8; 
                                }
                                100% { 
                                    transform: translate(-50%, -50%) scale(1.5); 
                                    opacity: 0; 
                                }
                            }
                            
                            .direction-arrow {
                                transition: transform 0.3s ease-out;
                            }
                        </style>
                    `,
                    iconSize: [40, 40],
                    iconAnchor: [20, 20],
                    className: 'user-location-icon'
                });
            }

            updateUserLocationMarker() {
                if (this.userLocationMarker) {
                    this.userLocationMarker.setLatLng([this.userLocation.lat, this.userLocation.lng]);
                    
                    // Update the icon to reflect current heading
                    const updatedIcon = this.createDirectionalUserIcon();
                    this.userLocationMarker.setIcon(updatedIcon);
                    
                    // Update popup content
                    this.userLocationMarker.setPopupContent(`
                        <div class="custom-popup">
                            <h3><i class="fas fa-map-marker-alt"></i> Your Location</h3>
                            <p>Lat: ${this.userLocation.lat.toFixed(6)}</p>
                            <p>Lng: ${this.userLocation.lng.toFixed(6)}</p>
                            <p>Accuracy: ±${this.userLocation.accuracy ? Math.round(this.userLocation.accuracy) : 'Unknown'} meters</p>
                            ${this.compassHeading !== null ? `<p>Heading: ${Math.round(this.compassHeading)}°</p>` : ''}
                            <button onclick="window.app.findNearestPandals()" style="background: #4caf50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 5px;">
                                Find Nearest Pandals
                            </button>
                        </div>
                    `);
                }
            }

            handleLocationError(error) {
                console.error('Location error details:', error);
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                let message = 'Unable to get your location. ';
                let instructions = '';
                
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        message += 'Location access was denied.';
                        if (isMobile) {
                            instructions = '\n\nFor mobile devices:\n1. Ensure your browser has location permission\n2. Check your device\'s location services are enabled\n3. Use HTTPS instead of HTTP (required for mobile)\n4. Try refreshing the page and allow location access';
                        } else {
                            instructions = '\n\nTo enable location tracking:\n1. Click the location icon in your browser\'s address bar\n2. Select "Allow" for location access\n3. Refresh the page and try again';
                        }
                        break;
                    case error.POSITION_UNAVAILABLE:
                        message += 'Location information is unavailable.';
                        if (isMobile) {
                            instructions = '\n\nFor mobile devices:\n1. Check your device\'s GPS/location services are enabled\n2. Move to an area with better GPS signal\n3. Ensure mobile data or WiFi is connected';
                        } else {
                            instructions = '\n\nPlease check:\n1. Your device has GPS/location services enabled\n2. You have a stable internet connection\n3. Try refreshing the page';
                        }
                        break;
                    case error.TIMEOUT:
                        message += 'Location request timed out.';
                        if (isMobile) {
                            instructions = '\n\nFor mobile devices:\n1. Move to an area with better GPS signal\n2. Check your internet connection\n3. Close other apps that might be using location';
                        } else {
                            instructions = '\n\nPlease:\n1. Check your internet connection\n2. Make sure you\'re not in a location with poor GPS signal\n3. Try again in a few seconds';
                        }
                        break;
                    default:
                        message += 'An unknown error occurred.';
                        if (isMobile) {
                            instructions = '\n\nFor mobile devices:\n1. Ensure the page is loaded via HTTPS\n2. Check browser permissions for location\n3. Try a different mobile browser';
                        } else {
                            instructions = '\n\nTry:\n1. Refreshing the page\n2. Checking your browser permissions\n3. Using a different browser if the problem persists';
                        }
                        break;
                }
                
                // Show protocol warning for mobile users
                if (isMobile && location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                    message += '\n\n⚠️ IMPORTANT: Mobile browsers require HTTPS for location access. Please use a secure connection.';
                }
                
                alert(message + instructions);
                
                console.log('Location error handled:', message + instructions);
            }

            // Helper methods for pandal cards
            focusOnPandal(pandalId) {
                const pandal = this.pandals.find(p => p.id === pandalId);
                if (pandal) {
                    this.map.setView([pandal.lat, pandal.lng], 16);
                    const marker = this.markers.find(m => m.pandalData.id === pandalId);
                    if (marker) {
                        marker.openPopup();
                    }
                }
            }

            quickAddToRoute(pandalId) {
                const pandal = this.pandals.find(p => p.id === pandalId);
                if (!pandal) return;

                // If route planner is not visible, show it
                const planner = document.getElementById('route-planner');
                if (planner.style.display === 'none') {
                    this.toggleRoutePlanner();
                }

                // Check the pandal in the checklist
                const checkbox = document.getElementById(`pandal-${pandalId}`);
                if (checkbox) {
                    checkbox.checked = true;
                    this.updateSelectedCount();
                    
                    // Scroll to the pandal in the checklist
                    checkbox.closest('div').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                    // Highlight the checkbox briefly
                    const pandalItem = checkbox.closest('div');
                    pandalItem.style.background = '#e8f5e8';
                    pandalItem.style.border = '2px solid #4caf50';
                    
                    setTimeout(() => {
                        pandalItem.style.background = '#f9f9f9';
                        pandalItem.style.border = 'none';
                    }, 2000);
                    
                    // Show success message
                    this.showBriefMessage(`✓ ${pandal.name} added to route plan!`);
                } else {
                    // If checklist is not loaded yet, show route planner first
                    setTimeout(() => this.quickAddToRoute(pandalId), 100);
                }
            }

            showBriefMessage(message) {
                // Create a brief success message
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = `
                    position: fixed;
                    top: 50px;
                    right: 20px;
                    background: #4caf50;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 5px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    z-index: 10000;
                    font-size: 14px;
                    animation: slideInRight 0.3s ease;
                `;
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            }

            findNearestPandals() {
                if (!this.userLocation) {
                    alert('Please enable location tracking first.');
                    return;
                }

                // Calculate distances to all pandals
                const pandalDistances = this.pandals.map(pandal => ({
                    ...pandal,
                    distance: this.calculateDistance(this.userLocation, pandal)
                }));

                // Sort by distance and get top 5
                const nearestPandals = pandalDistances
                    .sort((a, b) => a.distance - b.distance)
                    .slice(0, 5);

                // Display nearest pandals
                this.displayNearestPandals(nearestPandals);

                // Highlight nearest pandals on map
                this.highlightNearestPandals(nearestPandals);
            }

            displayNearestPandals(nearestPandals) {
                const routeInfo = document.getElementById('route-info');
                routeInfo.innerHTML = `
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h4><i class="fas fa-map-marker-alt"></i> Nearest Pandals</h4>
                        ${nearestPandals.map((pandal, index) => `
                            <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px; cursor: pointer;" 
                                 onclick="window.app.showPandalRoute(${pandal.id})">
                                <strong>${index + 1}. ${pandal.name}</strong><br>
                                <small>📍 ${pandal.distance.toFixed(2)} km away</small><br>
                                <small>🚇 ${pandal.nearestMetro}</small>
                            </div>
                        `).join('')}
                        <button onclick="window.app.createRouteFromUserLocation()" 
                                style="background: #ff6b6b; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; width: 100%;">
                            Plan Route from My Location
                        </button>
                    </div>
                `;
            }

            highlightNearestPandals(nearestPandals) {
                // Reset all markers to default
                this.markers.forEach(marker => {
                    const originalIcon = L.icon({
                        iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
                        shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    });
                    marker.setIcon(originalIcon);
                });

                // Highlight nearest pandals
                nearestPandals.forEach((pandal, index) => {
                    const marker = this.markers.find(m => m.pandalData.id === pandal.id);
                    if (marker) {
                        const highlightIcon = L.divIcon({
                            html: `<div style="background: #ff6b6b; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">${index + 1}</div>`,
                            iconSize: [30, 30],
                            className: 'nearest-pandal-icon'
                        });
                        marker.setIcon(highlightIcon);
                    }
                });
            }

            showPandalRoute(pandalId) {
                if (!this.userLocation) {
                    alert('Please enable location tracking first.');
                    return;
                }

                const pandal = this.pandals.find(p => p.id === pandalId);
                if (!pandal) return;

                // Create route from user location to pandal
                const waypoints = [
                    L.latLng(this.userLocation.lat, this.userLocation.lng),
                    L.latLng(pandal.lat, pandal.lng)
                ];

                // Remove existing route
                if (this.routeControl) {
                    this.map.removeControl(this.routeControl);
                }

                // Create new route line
                const routeLine = L.polyline(waypoints, {
                    color: '#4285f4',
                    weight: 4,
                    opacity: 0.8,
                    dashArray: '5, 10'
                }).addTo(this.map);

                // Fit map to show route
                this.map.fitBounds(routeLine.getBounds(), { padding: [20, 20] });

                // Show route info
                const distance = this.calculateDistance(this.userLocation, pandal);
                const estimatedTime = Math.ceil(distance * 10); // 10 minutes per km

                const routeInfo = document.getElementById('route-info');
                routeInfo.innerHTML = `
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h4><i class="fas fa-route"></i> Route to ${pandal.name}</h4>
                        <p><strong>Distance:</strong> ${distance.toFixed(2)} km</p>
                        <p><strong>Estimated Time:</strong> ${Math.floor(estimatedTime/60)}h ${estimatedTime%60}m</p>
                        <p><strong>Nearest Metro:</strong> ${pandal.nearestMetro}</p>
                        <p><strong>Crowd Level:</strong> ${pandal.crowdLevel}</p>
                        <button onclick="window.app.addToRoute(${pandal.id})" 
                                style="background: #4caf50; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            Add to My Route Plan
                        </button>
                    </div>
                `;
            }

            createRouteFromUserLocation() {
                if (!this.userLocation) {
                    alert('Please enable location tracking first.');
                    return;
                }

                // Add user location as starting point for route planning
                this.selectedPandals = [{
                    id: 'user',
                    name: 'Your Location',
                    lat: this.userLocation.lat,
                    lng: this.userLocation.lng,
                    area: 'Current',
                    theme: 'Start Point'
                }, ...this.selectedPandals];

                this.updateSelectedPandals();
                
                // Show route planner
                document.getElementById('route-planner').style.display = 'block';
            }
        }

        // Fullscreen functionality
        class FullscreenManager {
            constructor() {
                this.isFullscreen = false;
                this.mapContainer = document.querySelector('.map-container');
                this.fullscreenBtn = document.getElementById('fullscreen-toggle');
                this.fullscreenIcon = this.fullscreenBtn.querySelector('i');
                
                this.init();
            }

            init() {
                this.fullscreenBtn.addEventListener('click', () => {
                    this.toggleFullscreen();
                });

                // Handle escape key to exit fullscreen
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isFullscreen) {
                        this.exitFullscreen();
                    }
                });

                // Handle browser fullscreen change events
                document.addEventListener('fullscreenchange', () => {
                    if (!document.fullscreenElement && this.isFullscreen) {
                        this.exitFullscreen();
                    }
                });
            }

            toggleFullscreen() {
                if (this.isFullscreen) {
                    this.exitFullscreen();
                } else {
                    this.enterFullscreen();
                }
            }

            enterFullscreen() {
                this.mapContainer.classList.add('fullscreen');
                this.fullscreenIcon.className = 'fas fa-compress';
                this.fullscreenBtn.title = 'Exit Fullscreen';
                this.isFullscreen = true;

                // Trigger map resize after transition
                setTimeout(() => {
                    if (window.app && window.app.map) {
                        window.app.map.invalidateSize();
                    }
                }, 300);

                // Optional: Also enter browser fullscreen
                if (this.mapContainer.requestFullscreen) {
                    this.mapContainer.requestFullscreen().catch(err => {
                        console.log('Fullscreen request failed:', err);
                    });
                }
            }

            exitFullscreen() {
                this.mapContainer.classList.remove('fullscreen');
                this.fullscreenIcon.className = 'fas fa-expand';
                this.fullscreenBtn.title = 'Toggle Fullscreen';
                this.isFullscreen = false;

                // Exit browser fullscreen if active
                if (document.fullscreenElement) {
                    document.exitFullscreen().catch(err => {
                        console.log('Exit fullscreen failed:', err);
                    });
                }

                // Trigger map resize after transition
                setTimeout(() => {
                    if (window.app && window.app.map) {
                        window.app.map.invalidateSize();
                    }
                }, 300);
            }
        }

        // Location Selection Functions - Make it globally accessible
        window.selectLocation = function(location) {
            console.log('selectLocation called with:', location);
            
            try {
                // Hide location selector
                const overlay = document.getElementById('location-selector-overlay');
                if (overlay) {
                    overlay.style.display = 'none';
                    console.log('Overlay hidden successfully');
                } else {
                    console.error('Overlay element not found');
                    return;
                }
                
                // Set selected location in app
                if (window.app) {
                    console.log('App found, calling setLocation');
                    window.app.setLocation(location);
                } else {
                    console.log('App not ready, storing location for later');
                    // Store location for when app is ready
                    window.selectedLocation = location;
                }
                
                // Update page title and header based on location
                let title, headerTitle;
                if (location === 'kolkata') {
                    title = 'Durga Puja Pandal Map - Kolkata 2025';
                    headerTitle = '<i class="fas fa-map-marker-alt"></i> Kolkata Durga Puja Map 2025';
                } else if (location === 'kalyani') {
                    title = 'Durga Puja Pandal Map - Kalyani 2025';
                    headerTitle = '<i class="fas fa-map-marker-alt"></i> Kalyani Durga Puja Map 2025';
                } else if (location === 'chuchura') {
                    title = 'Durga Puja Pandal Map - Chuchura 2025';
                    headerTitle = '<i class="fas fa-map-marker-alt"></i> Chuchura Durga Puja Map 2025';
                } else if (location === 'bandel') {
                    title = 'Durga Puja Pandal Map - Bandel 2025';
                    headerTitle = '<i class="fas fa-map-marker-alt"></i> Bandel Durga Puja Map 2025';
                }
                
                document.title = title;
                
                const headerElement = document.querySelector('header h1');
                if (headerElement) {
                    headerElement.innerHTML = headerTitle;
                }
                
                console.log('Location selection completed successfully');
            } catch (error) {
                console.error('Error in selectLocation:', error);
                alert('Error: ' + error.message);
            }
        };

        // Initialize the application
        let app;
        let fullscreenManager;

        // Mobile touch enhancements
        function initMobileTouchEnhancements() {
            // Prevent zoom on double tap for iOS
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            // Add touch feedback to buttons and cards
            const touchElements = document.querySelectorAll('.btn, .pandal-card, .location-card');
            touchElements.forEach(element => {
                element.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.98)';
                    this.style.opacity = '0.8';
                }, { passive: true });

                element.addEventListener('touchend', function() {
                    setTimeout(() => {
                        this.style.transform = '';
                        this.style.opacity = '';
                    }, 150);
                }, { passive: true });

                element.addEventListener('touchcancel', function() {
                    this.style.transform = '';
                    this.style.opacity = '';
                }, { passive: true });
            });

            // Improve scroll behavior on mobile
            if ('scrollBehavior' in document.documentElement.style) {
                document.documentElement.style.scrollBehavior = 'smooth';
            }

            // Add swipe detection for sidebar on mobile
            if (window.innerWidth <= 768) {
                let startX, startY, distX, distY;
                const threshold = 150;
                const restraint = 100;

                document.addEventListener('touchstart', function(e) {
                    startX = e.changedTouches[0].pageX;
                    startY = e.changedTouches[0].pageY;
                }, { passive: true });

                document.addEventListener('touchend', function(e) {
                    distX = e.changedTouches[0].pageX - startX;
                    distY = e.changedTouches[0].pageY - startY;
                    
                    if (Math.abs(distX) >= threshold && Math.abs(distY) <= restraint) {
                        // Horizontal swipe detected
                        if (distX > 0) {
                            // Swipe right - could show sidebar
                            console.log('Swipe right detected');
                        } else {
                            // Swipe left - could hide sidebar
                            console.log('Swipe left detected');
                        }
                    }
                }, { passive: true });
            }

            // Improve select dropdowns on mobile
            const selects = document.querySelectorAll('select');
            selects.forEach(select => {
                select.addEventListener('focus', function() {
                    this.style.fontSize = '16px'; // Prevent zoom on iOS
                });
            });

            // Add haptic feedback for supported devices
            function addHapticFeedback(element) {
                element.addEventListener('click', function() {
                    if (navigator.vibrate) {
                        navigator.vibrate(50); // Short vibration
                    }
                });
            }

            // Add haptic feedback to important buttons
            const importantButtons = document.querySelectorAll('.btn-primary, .btn-success, .pandal-card');
            importantButtons.forEach(addHapticFeedback);
        }

        // HTTPS Help Function
        function showHttpsHelp() {
            const helpText = `
To use live location on mobile devices, you need HTTPS. Here are your options:

📱 QUICK SOLUTION: Use the "Demo Location" button for testing

🔧 FOR DEVELOPERS:

Option 1 - Simple Local HTTPS Server:
1. Install Python if not already installed
2. Run: python -m http.server 8000 --bind 127.0.0.1
3. Access via: http://localhost:8000

Option 2 - Use a service like:
• GitHub Pages (free HTTPS hosting)
• Netlify (free tier available)
• Vercel (free tier available)

Option 3 - Local HTTPS with certificates:
• Use tools like live-server with HTTPS
• Set up local SSL certificates

💡 TIP: Modern mobile browsers block location access on HTTP for security reasons.
            `;
            
            alert(helpText);
        }

        // Feedback System Functions (Global scope)
        let selectedRating = 0;

        function openFeedbackModal() {
            console.log('Opening feedback modal...');
            const modal = document.getElementById('feedbackModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Feedback modal opened');
            } else {
                console.error('Feedback modal not found');
            }
        }

        function closeFeedbackModal() {
            console.log('Closing feedback modal...');
            const modal = document.getElementById('feedbackModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Reset form
                selectedRating = 0;
                const nameField = document.getElementById('feedbackName');
                const messageField = document.getElementById('feedbackMessage');
                const formDiv = document.getElementById('feedbackForm');
                const successDiv = document.getElementById('feedbackSuccess');
                
                if (nameField) nameField.value = '';
                if (messageField) messageField.value = '';
                if (formDiv) formDiv.style.display = 'flex';
                if (successDiv) successDiv.style.display = 'none';
                
                // Reset stars
                document.querySelectorAll('.rating-star').forEach(star => {
                    star.classList.remove('active');
                });
                console.log('Feedback modal closed and reset');
            }
        }

        function submitFeedback() {
            console.log('Submitting feedback...');
            const nameField = document.getElementById('feedbackName');
            const messageField = document.getElementById('feedbackMessage');
            
            const name = nameField ? nameField.value || 'Anonymous' : 'Anonymous';
            const message = messageField ? messageField.value.trim() : '';
            
            if (!message) {
                alert('Please share your feedback message!');
                return;
            }

            // Log feedback submission
            console.log('Feedback Submitted:', {
                rating: selectedRating,
                name: name,
                message: message,
                timestamp: new Date().toISOString(),
                page: 'Durga Puja Map'
            });

            // Show success message
            const formDiv = document.getElementById('feedbackForm');
            const successDiv = document.getElementById('feedbackSuccess');
            
            if (formDiv) formDiv.style.display = 'none';
            if (successDiv) successDiv.style.display = 'block';
            
            console.log('Feedback submitted successfully');
        }

        // Initialize rating system
        function initializeRatingSystem() {
            const stars = document.querySelectorAll('.rating-star');
            
            stars.forEach((star, index) => {
                star.addEventListener('click', function() {
                    selectedRating = parseInt(this.dataset.rating);
                    console.log('Rating selected:', selectedRating);
                    
                    // Update star display
                    stars.forEach((s, i) => {
                        if (i < selectedRating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });

                star.addEventListener('mouseover', function() {
                    const hoverRating = parseInt(this.dataset.rating);
                    stars.forEach((s, i) => {
                        if (i < hoverRating) {
                            s.style.color = '#ffc107';
                        } else {
                            s.style.color = '#ddd';
                        }
                    });
                });
            });

            // Reset stars on mouse leave
            const ratingContainer = document.querySelector('.rating-stars');
            if (ratingContainer) {
                ratingContainer.addEventListener('mouseleave', function() {
                    stars.forEach((s, i) => {
                        if (i < selectedRating) {
                            s.style.color = '#ffc107';
                        } else {
                            s.style.color = '#ddd';
                        }
                    });
                });
            }

            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('feedbackModal');
                if (event.target === modal) {
                    closeFeedbackModal();
                }
            });
            
            console.log('Rating system initialized');
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing app...');
            
            // Show mobile HTTPS notice if needed
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isHTTPS = location.protocol === 'https:';
            const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            
            if (isMobile && !isHTTPS && !isLocalhost) {
                const notice = document.getElementById('mobile-https-notice');
                if (notice) {
                    notice.style.display = 'block';
                    console.log('Showing mobile HTTPS notice');
                }
            }
            
            // Initialize mobile touch enhancements
            initMobileTouchEnhancements();
            
            // Add backup event listeners for location buttons
            const kolkataBtn = document.querySelector("button[onclick=\"window.selectLocation('kolkata')\"]");
            const kalyaniBtn = document.querySelector("button[onclick=\"window.selectLocation('kalyani')\"]");
            
            if (kolkataBtn) {
                kolkataBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Kolkata button clicked via event listener');
                    window.selectLocation('kolkata');
                });
                console.log('Kolkata button event listener added');
            } else {
                console.error('Kolkata button not found');
            }
            
            if (kalyaniBtn) {
                kalyaniBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Kalyani button clicked via event listener');
                    window.selectLocation('kalyani');
                });
                console.log('Kalyani button event listener added');
            } else {
                console.error('Kalyani button not found');
            }
            
            // Initialize feedback system
            initializeRatingSystem();
            
            app = new DurgaPujaMap();
            fullscreenManager = new FullscreenManager();
            
            // Set initial location if stored
            if (window.selectedLocation) {
                app.setLocation(window.selectedLocation);
            }
            
            // Make app globally accessible
            window.app = app;
        });
    </script>
    </div> <!-- End main-content -->
</body>
</html>
